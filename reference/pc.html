<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Numerical Soil Profile Comparison — pc • aqp</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Numerical Soil Profile Comparison — pc"><meta property="og:description" content="Performs a numerical comparison of soil profiles using named properties,
based on a weighted, summed, depth-segment-aligned dissimilarity
calculation. If s is a SoilProfileCollection,
site-level variables (2 or more) can also be used. The site-level and
horizon-level dissimilarity matrices are then re-scaled and averaged."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">aqp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.40</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ncss-tech/aqp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Numerical Soil Profile Comparison</h1>
    <small class="dont-index">Source: <a href="https://github.com/ncss-tech/aqp/blob/HEAD/R/profile_compare.R" class="external-link"><code>R/profile_compare.R</code></a></small>
    <div class="hidden name"><code>pc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Performs a numerical comparison of soil profiles using named properties,
based on a weighted, summed, depth-segment-aligned dissimilarity
calculation. If <code>s</code> is a <code><a href="SoilProfileCollection-class.html">SoilProfileCollection</a></code>,
site-level variables (2 or more) can also be used. The site-level and
horizon-level dissimilarity matrices are then re-scaled and averaged.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">pc</span><span class="op">(</span>
  <span class="va">s</span>,
  <span class="va">vars</span>,
  <span class="va">max_d</span>,
  <span class="va">k</span>,
  filter <span class="op">=</span> <span class="cn">NULL</span>,
  sample_interval <span class="op">=</span> <span class="cn">NA</span>,
  replace_na <span class="op">=</span> <span class="cn">TRUE</span>,
  add_soil_flag <span class="op">=</span> <span class="cn">TRUE</span>,
  return_depth_distances <span class="op">=</span> <span class="cn">FALSE</span>,
  strict_hz_eval <span class="op">=</span> <span class="cn">FALSE</span>,
  progress <span class="op">=</span> <span class="st">"none"</span>,
  plot.depth.matrix <span class="op">=</span> <span class="cn">FALSE</span>,
  rescale.result <span class="op">=</span> <span class="cn">FALSE</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>s</dt>
<dd><p>a dataframe with at least 2 columns of soil properties, and an 'id'
column for each profile. horizon depths must be integers and
self-consistent, or a <code>SoilProfileCollection</code> object</p></dd>
<dt>vars</dt>
<dd><p>A vector with named properties that will be used in the
comparison. These are typically column names describing horizon-level
attributes (2 or more), but can also contain site-level attributes (2 or
more) if <code>s</code> is a <code><a href="SoilProfileCollection-class.html">SoilProfileCollection</a></code>.</p></dd>
<dt>max_d</dt>
<dd><p>depth-slices up to this depth are considered in the comparison</p></dd>
<dt>k</dt>
<dd><p>a depth-weighting coeficient, use '0' for no depth-weighting (see
examples below)</p></dd>
<dt>filter</dt>
<dd><p>an index used to determine which horizons (rows) are included
in the analysis</p></dd>
<dt>sample_interval</dt>
<dd><p>use every n-th depth slice instead of every depth
slice, useful for working with &gt; 1000 profiles at a time</p></dd>
<dt>replace_na</dt>
<dd><p>if TRUE, missing data are replaced by maximum
dissimilarity (TRUE)</p></dd>
<dt>add_soil_flag</dt>
<dd><p>The algorithm will generate a 'soil'/'non-soil' matrix
for use when comparing soil profiles with large differences in depth (TRUE).
See details section below.</p></dd>
<dt>return_depth_distances</dt>
<dd><p>return intermediate, depth-wise dissimilarity
results (FALSE)</p></dd>
<dt>strict_hz_eval</dt>
<dd><p>should horizons be strictly checked for internal
self-consistency? (FALSE)</p></dd>
<dt>progress</dt>
<dd><p>'none' (default): argument passed to <code>ddply</code> and
related functions, see <code>create_progress_bar</code> for all possible
options; 'text' is usually fine.</p></dd>
<dt>plot.depth.matrix</dt>
<dd><p>should a plot of the 'soil'/'non-soil' matrix be
returned (FALSE)</p></dd>
<dt>rescale.result</dt>
<dd><p>should the result be rescaled by dividing by max(D)
(FALSE)</p></dd>
<dt>verbose</dt>
<dd><p>extra debug output (FALSE)</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A dissimilarity matrix object of class 'dissimilarity, dist',
optionally scaled by max(D).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Variability in soil depth can interfere significantly with the calculation
of between-profile dissimilarity-- what is the numerical ``distance'' (or
dissimilarity) between a slice of soil from profile A and the corresponding,
but missing, slice from a shallower profile B? Gower's distance metric would
yield a NULL distance, despite the fact that intuition suggests otherwise:
shallower soils should be more dissimilar from deeper soils. For example,
when a 25 cm deep profile is compared with a 50 cm deep profile, numerical
distances are only accumulated for the first 25 cm of soil (distances from
26 - 50 cm are NULL). When summed, the total distance between these profiles
will generally be less than the distance between two profiles of equal
depth. Our algorithm has an option (setting replace_na=TRUE) to replace NULL
distances with the maximum distance between any pair of profiles for the
current depth slice. In this way, the numerical distance between a slice of
soil and a corresponding slice of non-soil reflects the fact that these two
materials should be treated very differently (i.e. maximum dissimilarity).</p>
<p>This alternative calculation of dissimilarities between soil and non-soil
slices solves the problem of comparing shallow profiles with deeper
profiles. However, it can result in a new problem: distances calculated
between two shallow profiles will be erroneously inflated beyond the extent
of either profile's depth. Our algorithm has an additional option (setting
add_soil_flag=TRUE) that will preserve NULL distances between slices when
both slices represent non-soil material. With this option enabled, shallow
profiles will only accumulate mutual dissimilarity to the depth of the
deeper profile.</p>
<p>Note that when the <code>add_soil_flag</code> option is enabled (default), slices
are classified as 'soil' down to the maximum depth to which at least one of
variables used in the dissimilarity calculation is not NA. This will cause
problems when profiles within a collection contain all NAs within the
columns used to determine dissimilarity. An approach for identifying and
removing these kind of profiles is presented in the examples section below.</p>
<p>A notice is issued if there are any NA values within the matrix used for
distance calculations, as these values are optionally replaced by the max
dissimilarity.</p>
<p>Our approach builds on the work of (Moore, 1972) and the previously
mentioned depth-slicing algorithm.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    
<ul><li><p>D.E. Beaudette, P. Roudier, A.T. O'Geen, Algorithms for quantitative pedology: A toolkit for soil scientists, Computers &amp; Geosciences, Volume 52, 2013, Pages 258-268, ISSN 0098-3004, doi: <a href="https://doi.org/10.1016/j.cageo.2012.10.020" class="external-link">10.1016/j.cageo.2012.10.020</a>
.</p></li>
<li><p>Moore, A.; Russell, J. &amp; Ward, W. Numerical analysis of soils: A comparison of three soil profile models with field classification. Journal of Soil Science, 1972, 23, 194-209.</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="slice-methods.html">slice</a></code>, <code><a href="https://rdrr.io/pkg/cluster/man/daisy.html" class="external-link">daisy</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Dylan E. Beaudette</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="co">## 1. check out the influence depth-weight coef:</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="fl">4</span><span class="op">)</span></span>
<span class="r-in"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.1</span>,<span class="fl">0.05</span>,<span class="fl">0.01</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span class="r-in"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">k</span><span class="op">*</span><span class="va">z</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">z</span> <span class="op">~</span> <span class="va">w</span>, groups<span class="op">=</span><span class="va">k</span>, ylim<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">105</span>,<span class="op">-</span><span class="fl">5</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">105</span><span class="op">)</span>, type<span class="op">=</span><span class="st">'l'</span>,</span>
<span class="r-in">       ylab<span class="op">=</span><span class="st">'Depth'</span>, xlab<span class="op">=</span><span class="st">'Weighting Factor'</span>, asp<span class="op">=</span><span class="fl">1.5</span>,</span>
<span class="r-in">       auto.key<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>columns<span class="op">=</span><span class="fl">4</span>, lines<span class="op">=</span><span class="cn">TRUE</span>, points<span class="op">=</span><span class="cn">FALSE</span>, title<span class="op">=</span><span class="st">"k"</span>, cex<span class="op">=</span><span class="fl">0.8</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span class="r-in">       panel<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">         <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/panel.functions.html" class="external-link">panel.grid</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">-</span><span class="fl">1</span>,v<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span class="r-in">         <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/panel.superpose.html" class="external-link">panel.superpose</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span class="r-in">       <span class="op">}</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-plt img"><img src="pc-1.png" alt="" width="768" height="475"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># more soil properties</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp2</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">depths</span><span class="op">(</span><span class="va">sp2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">d.1</span> <span class="op">&lt;-</span> <span class="fu">profile_compare</span><span class="op">(</span><span class="va">sp2</span>, vars<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'prop'</span>,<span class="st">'field_ph'</span>,<span class="st">'hue'</span>,<span class="st">'value'</span><span class="op">)</span>,</span>
<span class="r-in">                       max_d<span class="op">=</span><span class="fl">100</span>, k<span class="op">=</span><span class="fl">0.01</span>, plot.depth.matrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing dissimilarity matrices from 18 profiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  [0.34 Mb]</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># add some missing data:</span></span>
<span class="r-in"><span class="va">sp2</span><span class="op">$</span><span class="va">prop</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span class="r-in"><span class="va">d.2</span> <span class="op">&lt;-</span> <span class="fu">profile_compare</span><span class="op">(</span><span class="va">sp2</span>, vars<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'prop'</span>,<span class="st">'field_ph'</span>,<span class="st">'hue'</span>,<span class="st">'value'</span><span class="op">)</span>,</span>
<span class="r-in">                       max_d<span class="op">=</span><span class="fl">100</span>, k<span class="op">=</span><span class="fl">0.01</span>, plot.depth.matrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing dissimilarity matrices from 18 profiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  [0.34 Mb]</span>
<span class="r-plt img"><img src="pc-2.png" alt="" width="768" height="475"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># note small changes in D:</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">d.1</span>, <span class="va">d.2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9987445</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## 3. identify profiles within a collection that contain all NAs</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1010101</span><span class="op">)</span></span>
<span class="r-in"><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="pbindlist.html">pbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="va">random_profile</span>, SPC<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># replace first profile's data with NA</span></span>
<span class="r-in"><span class="va">na.required</span> <span class="op">&lt;-</span> <span class="fu"><a href="nrow.html">nrow</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="va">s</span><span class="op">$</span><span class="va">p1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">na.required</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span class="r-in"><span class="va">s</span><span class="op">$</span><span class="va">p2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">na.required</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># attempt profile comparison: this won't work, throws an error</span></span>
<span class="r-in"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">profile_compare</span><span class="op">(</span><span class="va">s</span>, vars<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'p1'</span>,<span class="st">'p2'</span><span class="op">)</span>, max_d<span class="op">=</span><span class="fl">100</span>, k<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing dissimilarity matrices from 10 profiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  [0.23 Mb]</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># check for soils that are missing all clay / total RF data</span></span>
<span class="r-in"><span class="va">f.check.NA</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">i</span><span class="op">$</span><span class="va">p1</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">i</span><span class="op">$</span><span class="va">p2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="nrow.html">nrow</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span></span>
<span class="r-in"><span class="va">missing.too.much.data.idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">f.check.NA</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># remove bad profiles and try again: works</span></span>
<span class="r-in"><span class="va">s.no.na</span> <span class="op">&lt;-</span> <span class="fu">profile_compare</span><span class="op">(</span><span class="va">s</span><span class="op">[</span><span class="op">-</span><span class="va">missing.too.much.data.idx</span>, <span class="op">]</span>,</span>
<span class="r-in">                           vars<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'p1'</span>,<span class="st">'p2'</span><span class="op">)</span>,</span>
<span class="r-in">                           max_d<span class="op">=</span><span class="fl">100</span>, k<span class="op">=</span><span class="fl">0</span>, plot.depth.matrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing dissimilarity matrices from 9 profiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  [0.21 Mb]</span>
<span class="r-plt img"><img src="pc-3.png" alt="" width="768" height="475"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## 4. better plotting of dendrograms with ape package:</span></span>
<span class="r-in"><span class="kw">if</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span> <span class="op">&amp;</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/" class="external-link">cluster</a></span><span class="op">)</span> <span class="op">&amp;</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp2</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu">depths</span><span class="op">(</span><span class="va">sp2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span>
<span class="r-in">  <span class="fu"><a href="site.html">site</a></span><span class="op">(</span><span class="va">sp2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">surface</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">profile_compare</span><span class="op">(</span><span class="va">sp2</span>, vars<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'prop'</span>,<span class="st">'field_ph'</span>,<span class="st">'hue'</span>,<span class="st">'value'</span><span class="op">)</span>,</span>
<span class="r-in">                         max_d<span class="op">=</span><span class="fl">100</span>, k<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/diana.html" class="external-link">diana</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/as.phylo.html" class="external-link">as.phylo</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/as.hclust.html" class="external-link">as.hclust</a></span><span class="op">(</span><span class="va">h</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu"><a href="SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span><span class="va">p</span>, show.tip.label<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html" class="external-link">tiplabels</a></span><span class="op">(</span><span class="va">sp2</span><span class="op">$</span><span class="va">surface</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">h</span>, <span class="fl">3</span><span class="op">)</span>, bg<span class="op">=</span><span class="cn">NA</span>, cex<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co">## 5. other uses of the dissimilarity matrix</span></span>
<span class="r-in">  <span class="co"># Sammon Mapping: doesn't like '0' values in dissimilarity matrix</span></span>
<span class="r-in">  <span class="va">d.sam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/sammon.html" class="external-link">sammon</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># simple plot</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span> ; <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu"><a href="SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span><span class="va">d.sam</span><span class="op">$</span><span class="va">points</span>, type <span class="op">=</span> <span class="st">"n"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">d.sam</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">d.sam</span><span class="op">$</span><span class="va">points</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">d.sam</span><span class="op">$</span><span class="va">points</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">       cex<span class="op">=</span><span class="fl">0.75</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">h</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: ape</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: cluster</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: MASS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> This is already a SoilProfileCollection-class object, doing nothing.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing dissimilarity matrices from 18 profiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  [0.34 Mb]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial stress        : 0.06149</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stress after  10 iters: 0.03420, magic = 0.092</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stress after  20 iters: 0.02491, magic = 0.500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stress after  30 iters: 0.02385, magic = 0.500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stress after  40 iters: 0.02327, magic = 0.500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stress after  50 iters: 0.02296, magic = 0.500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stress after  60 iters: 0.02280, magic = 0.500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stress after  70 iters: 0.02273, magic = 0.500</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## 6. try out the 'sample_interval' argument</span></span>
<span class="r-in"><span class="co"># compute using sucessively larger sampling intervals</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">)</span></span>
<span class="r-in"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">profile_compare</span><span class="op">(</span><span class="va">sp3</span>, vars<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'clay'</span>,<span class="st">'cec'</span>,<span class="st">'ph'</span><span class="op">)</span>,</span>
<span class="r-in">                     max_d<span class="op">=</span><span class="fl">100</span>, k<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing dissimilarity matrices from 10 profiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  [0.22 Mb]</span>
<span class="r-in"><span class="va">d.2</span> <span class="op">&lt;-</span> <span class="fu">profile_compare</span><span class="op">(</span><span class="va">sp3</span>, vars<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'clay'</span>,<span class="st">'cec'</span>,<span class="st">'ph'</span><span class="op">)</span>,</span>
<span class="r-in">                       max_d<span class="op">=</span><span class="fl">100</span>, k<span class="op">=</span><span class="fl">0.01</span>, sample_interval<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing dissimilarity matrices from 10 profiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  [0.11 Mb]</span>
<span class="r-in"><span class="va">d.10</span> <span class="op">&lt;-</span> <span class="fu">profile_compare</span><span class="op">(</span><span class="va">sp3</span>, vars<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'clay'</span>,<span class="st">'cec'</span>,<span class="st">'ph'</span><span class="op">)</span>,</span>
<span class="r-in">                        max_d<span class="op">=</span><span class="fl">100</span>, k<span class="op">=</span><span class="fl">0.01</span>, sample_interval<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing dissimilarity matrices from 10 profiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  [0.02 Mb]</span>
<span class="r-in"><span class="va">d.20</span> <span class="op">&lt;-</span> <span class="fu">profile_compare</span><span class="op">(</span><span class="va">sp3</span>, vars<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'clay'</span>,<span class="st">'cec'</span>,<span class="st">'ph'</span><span class="op">)</span>,</span>
<span class="r-in">                        max_d<span class="op">=</span><span class="fl">100</span>, k<span class="op">=</span><span class="fl">0.01</span>, sample_interval<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing dissimilarity matrices from 10 profiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  [0.01 Mb]</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># check the results via hclust / dendrograms</span></span>
<span class="r-in"><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfcol<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>, horiz<span class="op">=</span><span class="cn">TRUE</span>, main<span class="op">=</span><span class="st">'Every Depth Slice'</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">d.2</span><span class="op">)</span><span class="op">)</span>, horiz<span class="op">=</span><span class="cn">TRUE</span>, main<span class="op">=</span><span class="st">'Every 2nd Depth Slice'</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">d.10</span><span class="op">)</span><span class="op">)</span>, horiz<span class="op">=</span><span class="cn">TRUE</span>, main<span class="op">=</span><span class="st">'Every 10th Depth Slice'</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">d.20</span><span class="op">)</span><span class="op">)</span>, horiz<span class="op">=</span><span class="cn">TRUE</span>, main<span class="op">=</span><span class="st">'Every 20th Depth Slice'</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Dylan Beaudette, Pierre Roudier, Andrew Brown.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

