<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Slab-Wise Aggregation of SoilProfileCollection Objects — slab • aqp</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Slab-Wise Aggregation of SoilProfileCollection Objects — slab"><meta name="description" content='Aggregate soil properties along user-defined slabs, and optionally within
groups.
Multiple continuous variables OR a single categorical (factor) variable can
be aggregated within a call to slab(). Basic error checking is
performed to make sure that top and bottom horizon boundaries make sense.
User-defined aggregate functions (slab.fun) should return a named
vector of results. A new, named column will appear in the results of
slab() for every named element of a vector returned by slab.fun.
See examples below for a simple example of a slab function that computes
mean, mean +/- 1 standard deviation. The default slab function wraps
stats::quantile(). Note that if group is a factor it must not contain NAs.
slab() uses dice() to "resample" profiles to 1cm slices from depth 0 to max(x) (or slab.structure[2], if defined).
Sometimes slab() is used to conveniently re-arrange data vs. aggregate.
This is performed by specifying identity in slab.fun. See
examples below for a demonstration of this functionality.
The default slab.fun was changed 2019-10-30 from a wrapper around
Hmisc::hdquantile() to a wrapper around stats::quantile(). See
examples below for a simple way to switch to the HD quantile estimator.
Execution time scales linearly (slower) with the total number of profiles in
object, and exponentially (faster) as the number of profiles / group
is increased. slab() and dice() are much faster and require less
memory if input data are either numeric or character.
There are several possible ways to define slabs, using slab.structure:
a single integer, e.g. 10: data are aggregated over a regular sequence of 10-unit thickness slabs
a vector of 2 integers, e.g. c(50, 60): data are aggregated over depths spanning 50-60 depth units
a vector of 3 or more integers, e.g. c(0, 5, 10, 50, 100): data are aggregated over the depths spanning 0-5, 5-10, 10-50, 50-100 depth units

'><meta property="og:description" content='Aggregate soil properties along user-defined slabs, and optionally within
groups.
Multiple continuous variables OR a single categorical (factor) variable can
be aggregated within a call to slab(). Basic error checking is
performed to make sure that top and bottom horizon boundaries make sense.
User-defined aggregate functions (slab.fun) should return a named
vector of results. A new, named column will appear in the results of
slab() for every named element of a vector returned by slab.fun.
See examples below for a simple example of a slab function that computes
mean, mean +/- 1 standard deviation. The default slab function wraps
stats::quantile(). Note that if group is a factor it must not contain NAs.
slab() uses dice() to "resample" profiles to 1cm slices from depth 0 to max(x) (or slab.structure[2], if defined).
Sometimes slab() is used to conveniently re-arrange data vs. aggregate.
This is performed by specifying identity in slab.fun. See
examples below for a demonstration of this functionality.
The default slab.fun was changed 2019-10-30 from a wrapper around
Hmisc::hdquantile() to a wrapper around stats::quantile(). See
examples below for a simple way to switch to the HD quantile estimator.
Execution time scales linearly (slower) with the total number of profiles in
object, and exponentially (faster) as the number of profiles / group
is increased. slab() and dice() are much faster and require less
memory if input data are either numeric or character.
There are several possible ways to define slabs, using slab.structure:
a single integer, e.g. 10: data are aggregated over a regular sequence of 10-unit thickness slabs
a vector of 2 integers, e.g. c(50, 60): data are aggregated over depths spanning 50-60 depth units
a vector of 3 or more integers, e.g. c(0, 5, 10, 50, 100): data are aggregated over the depths spanning 0-5, 5-10, 10-50, 50-100 depth units

'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aqp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/aqp-overview.html">An Overview of the aqp Package</a></li>
    <li><a class="dropdown-item" href="../articles/Introduction-to-SoilProfileCollection-Objects.html">Introduction to SoilProfileCollection Objects</a></li>
    <li><a class="dropdown-item" href="../articles/label-placement.html">Overlapping Annotation</a></li>
    <li><a class="dropdown-item" href="../articles/missing-data.html">Missing Data</a></li>
    <li><a class="dropdown-item" href="../articles/Munsell-color-conversion.html">Munsell Color Conversion</a></li>
    <li><a class="dropdown-item" href="../articles/NCSP.html">Numerical Classification of Soil Profiles</a></li>
    <li><a class="dropdown-item" href="../articles/new-in-aqp-2.html">What is new in aqp 2.x?</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncss-tech/aqp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Slab-Wise Aggregation of SoilProfileCollection Objects</h1>
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/aqp/blob/master/R/slab.R" class="external-link"><code>R/slab.R</code></a></small>
      <div class="d-none name"><code>slab.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Aggregate soil properties along user-defined <code>slabs</code>, and optionally within
groups.</p>
<p>Multiple continuous variables OR a single categorical (factor) variable can
be aggregated within a call to <code>slab()</code>. Basic error checking is
performed to make sure that top and bottom horizon boundaries make sense.
User-defined aggregate functions (<code>slab.fun</code>) should return a named
vector of results. A new, named column will appear in the results of
<code>slab()</code> for every named element of a vector returned by <code>slab.fun</code>.
See examples below for a simple example of a slab function that computes
mean, mean +/- 1 standard deviation. The default slab function wraps
<code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">stats::quantile()</a></code>. Note that if <code>group</code> is a factor it must not contain NAs.</p>
<p><code>slab()</code> uses <code><a href="dice-SoilProfileCollection-method.html">dice()</a></code> to "resample" profiles to 1cm slices from depth 0 to <code>max(x)</code> (or <code>slab.structure[2]</code>, if defined).</p>
<p>Sometimes <code>slab()</code> is used to conveniently re-arrange data vs. aggregate.
This is performed by specifying <code>identity</code> in <code>slab.fun</code>. See
examples below for a demonstration of this functionality.</p>
<p>The default <code>slab.fun</code> was changed 2019-10-30 from a wrapper around
<code><a href="https://rdrr.io/pkg/Hmisc/man/hdquantile.html" class="external-link">Hmisc::hdquantile()</a></code> to a wrapper around <code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">stats::quantile()</a></code>. See
examples below for a simple way to switch to the HD quantile estimator.</p>
<p>Execution time scales linearly (slower) with the total number of profiles in
<code>object</code>, and exponentially (faster) as the number of profiles / group
is increased. <code>slab()</code> and <code><a href="dice-SoilProfileCollection-method.html">dice()</a></code> are much faster and require less
memory if input data are either numeric or character.</p>
<p>There are several possible ways to define slabs, using <code>slab.structure</code>:</p><ul><li><p>a single integer, e.g. 10: data are aggregated over a regular sequence of 10-unit thickness slabs</p></li>
<li><p>a vector of 2 integers, e.g. c(50, 60): data are aggregated over depths spanning 50-60 depth units</p></li>
<li><p>a vector of 3 or more integers, e.g. c(0, 5, 10, 50, 100): data are aggregated over the depths spanning 0-5, 5-10, 10-50, 50-100 depth units</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'SoilProfileCollection'</span></span>
<span><span class="fu">slab</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">fm</span>,</span>
<span>  slab.structure <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  strict <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  byhz <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  slab.fun <span class="op">=</span> <span class="fu">slab_function</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span>,</span>
<span>  cpm <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">slab_function</span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">"numeric"</span>, <span class="st">"factor"</span>, <span class="st">"hd"</span>, <span class="st">"weighted.numeric"</span>, <span class="st">"weighted.factor"</span>, <span class="st">"fast"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>a SoilProfileCollection</p></dd>


<dt id="arg-fm">fm<a class="anchor" aria-label="anchor" href="#arg-fm"></a></dt>
<dd><p>A formula: either <code>groups ~ var1 + var2 + var3</code> where named
variables are aggregated within <code>groups' OR where named variables are aggregated across the entire collection </code> ~ var1 + var2 + var3<code>. If </code>groups<code>is a factor it must not contain</code>NA`</p></dd>


<dt id="arg-slab-structure">slab.structure<a class="anchor" aria-label="anchor" href="#arg-slab-structure"></a></dt>
<dd><p>integer vector: user-defined slab structure. See Details.</p></dd>


<dt id="arg-strict">strict<a class="anchor" aria-label="anchor" href="#arg-strict"></a></dt>
<dd><p>logical: should horizons be strictly checked for self-consistency?</p></dd>


<dt id="arg-byhz">byhz<a class="anchor" aria-label="anchor" href="#arg-byhz"></a></dt>
<dd><p>logical: should horizons or whole profiles be removed by logic checks in <code>strict</code>? Default <code>TRUE</code> removes only offending horizons, <code>FALSE</code> removes whole profiles with one or more illogical horizons.</p></dd>


<dt id="arg-slab-fun">slab.fun<a class="anchor" aria-label="anchor" href="#arg-slab-fun"></a></dt>
<dd><p>Function used to process each 'slab' of data, ideally returning a vector with names attribute. Defaults to a wrapper function around <code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">stats::quantile()</a></code>. See details.</p></dd>


<dt id="arg-cpm">cpm<a class="anchor" aria-label="anchor" href="#arg-cpm"></a></dt>
<dd><p>Strategy for normalizing slice-wise probabilities, dividing by either:</p><ul><li><p>number of profiles with data at the current slice (<code>cpm = 1</code>), or</p></li>
<li><p>by the number of profiles in the collection (<code>cpm = 2</code>).</p></li>
</ul><p>Mode 1 values will always sum to the contributing fraction, while mode 2 values will always sum to 1.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Column name containing site-level weights</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>further arguments passed to <code>slab.fun</code></p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>one of <code>"numeric"</code>, <code>"factor"</code>, <code>"hd"</code>, <code>"weighted.numeric"</code>, <code>"weighted.factor"</code>, <code>"fast"</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Output is returned in long format, such that slice-wise aggregates are returned once for each combination of grouping level (optional), variable described in the <code>fm</code> argument, and depth-wise 'slab'.</p>
<p>Aggregation of numeric variables, using the default slab function:</p><ul><li><p>variable: The names of variables included in <code>fm</code></p></li>
<li><p>groupname: The name of the grouping variable when provided, otherwise a fake grouping variable named 'all.profiles'.</p></li>
<li><p>p.q5: The slice-wise 5th percentile.</p></li>
<li><p>p.q25: The slice-wise 25th percentile</p></li>
<li><p>p.q50: The slice-wise 50th percentile (median)</p></li>
<li><p>p.q75: The slice-wise 75th percentile</p></li>
<li><p>p.q95: The slice-wise 95th percentile</p></li>
<li><p>top: The slab top boundary</p></li>
<li><p>bottom The slab bottom boundary.</p></li>
<li><p>contributing_fraction: The fraction of profiles contributing to the aggregate value, ranges from 1/n_profiles to 1</p></li>
</ul><p>When a single factor variable is used, slice-wise probabilities for each
level of that factor are returned as:</p><ul><li><p>variable: The names of factor variable included in <code>fm</code></p></li>
<li><p>groupname: The name of the grouping variable when provided, otherwise a fake grouping variable named 'all.profiles'</p></li>
<li><p>A: The slice-wise probability of level A</p></li>
<li><p>B: The slice-wise probability of level B</p></li>
<li><p>n: The slice-wise probability of level n</p></li>
<li><p>top: The slab top boundary.</p></li>
<li><p>bottom: The slab bottom boundary</p></li>
<li><p>contributing_fraction: The fraction of profiles contributing to the aggregate value, ranges from 1/n_profiles to 1</p></li>
</ul><p><code>slab_function()</code>: return an aggregation function based on the <code>method</code> argument</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>slab_function()</code>: The default <code>"numeric"</code> aggregation method is the <code>"fast"</code> numeric (quantile) method. Additional methods include <code>"factor"</code> for categorical data, <code>"hd"</code> to use the Harrell-Davis Distribution-Free Quantile Estimator from the Hmisc package, and "<code>weighted</code>" to use a weighted quantile method from the Hmisc package</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Arguments to <code>slab()</code> have changed with aqp 1.5 (2012-12-29) as part of a code clean-up and optimization. Calculation of
weighted-summaries was broken in <code>aqp 1.2-6 (2012-06-26), and removed as of aqp 1.5 (2012-12-29). </code>slab()“ replaced the previously defined <code>soil.slot.multiple</code> function as of aqp 0.98-8.58 (2011-12-21).</p>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>
    <p></p><dl><dt>data = "SoilProfileCollection"</dt>
<dd><p>Typical
usage, where input is a <code><a href="SoilProfileCollection-class.html">SoilProfileCollection</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>D.E. Beaudette, P. Roudier, A.T. O'Geen, Algorithms for
quantitative pedology: A toolkit for soil scientists, Computers &amp;
Geosciences, Volume 52, March 2013, Pages 258-268,
10.1016/j.cageo.2012.10.020.</p>
<p>Harrell FE, Davis CE (1982): A new distribution-free quantile estimator.
Biometrika 69:635-640.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="dice-SoilProfileCollection-method.html">dice()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>D.E. Beaudette</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## basic examples</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load sample data, upgrade to SoilProfileCollection</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="depths.html">depths</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="hzdesgnname.html">hzdesgnname</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"name"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># aggregate entire collection with two different segment sizes</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp1</span>, fm <span class="op">=</span> <span class="op">~</span> <span class="va">prop</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> horizons with zero thickness have been omitted from results</span>
<span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp1</span>, fm <span class="op">=</span> <span class="op">~</span> <span class="va">prop</span>, slab.structure<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> horizons with zero thickness have been omitted from results</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check output</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'data.frame':	240 obs. of  10 variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ variable             : Factor w/ 1 level "prop": 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ all.profiles         : num  1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ p.q5                 : num  0 0 0 0.4 0.4 0.4 1.4 1.4 1.4 1.4 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ p.q25                : num  0 0 1 1 1 3 3 3 3 3 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ p.q50                : num  3 3 3 5 5 5 5 5 5 5 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ p.q75                : num  8 8 7 7 7 7 7 7 7 7 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ p.q95                : num  13.6 13.6 14 14 14 16.4 16.4 16.4 16.4 16.4 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ contributing_fraction: num  1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ top                  : int  0 1 2 3 4 5 6 7 8 9 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ bottom               : int  1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># stack into long format</span></span></span>
<span class="r-in"><span><span class="va">ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/make.groups.html" class="external-link">make.groups</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ab</span><span class="op">$</span><span class="va">which</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ab</span><span class="op">$</span><span class="va">which</span>, levels<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'b'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>labels<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'1-cm Interval'</span>, <span class="st">'5-cm Interval'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot median and IQR</span></span></span>
<span class="r-in"><span><span class="co"># custom plotting function for uncertainty viz.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">top</span> <span class="op">~</span> <span class="va">p.q50</span> <span class="op">|</span> <span class="va">which</span>, data<span class="op">=</span><span class="va">ab</span>, ylab<span class="op">=</span><span class="st">'Depth'</span>,</span></span>
<span class="r-in"><span>       xlab<span class="op">=</span><span class="st">'median bounded by 25th and 75th percentiles'</span>,</span></span>
<span class="r-in"><span>       lower<span class="op">=</span><span class="va">ab</span><span class="op">$</span><span class="va">p.q25</span>, upper<span class="op">=</span><span class="va">ab</span><span class="op">$</span><span class="va">p.q75</span>, ylim<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">250</span>,<span class="op">-</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       panel<span class="op">=</span><span class="va">panel.depth_function</span>,</span></span>
<span class="r-in"><span>       prepanel<span class="op">=</span><span class="va">prepanel.depth_function</span>,</span></span>
<span class="r-in"><span>       cf<span class="op">=</span><span class="va">ab</span><span class="op">$</span><span class="va">contributing_fraction</span>,</span></span>
<span class="r-in"><span>       alpha<span class="op">=</span><span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>       layout<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>       <span class="op">)</span></span></span>
<span class="r-plt img"><img src="slab-1.png" alt="" width="700" height="1133"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###</span></span></span>
<span class="r-in"><span><span class="co">### re-arrange data / no aggregation</span></span></span>
<span class="r-in"><span><span class="co">###</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load sample data, upgrade to SoilProfileCollection</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="depths.html">depths</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> This is already a SoilProfileCollection-class object, doing nothing.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># arrange data by ID</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp1</span>, fm <span class="op">=</span> <span class="va">id</span> <span class="op">~</span> <span class="va">prop</span>, slab.fun<span class="op">=</span><span class="va">identity</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> horizons with zero thickness have been omitted from results</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># convert id to a factor for plotting</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check output</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'data.frame':	2160 obs. of  6 variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ variable             : Factor w/ 1 level "prop": 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ id                   : Factor w/ 9 levels "P001","P002",..: 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ value                : int  13 13 7 7 7 7 7 7 7 7 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ contributing_fraction: num  1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ top                  : int  0 1 2 3 4 5 6 7 8 9 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ bottom               : int  1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot via step function</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">top</span> <span class="op">~</span> <span class="va">value</span> <span class="op">|</span> <span class="va">id</span>, data<span class="op">=</span><span class="va">a</span>, ylab<span class="op">=</span><span class="st">'Depth'</span>,</span></span>
<span class="r-in"><span>       ylim<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">250</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span>, as.table<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>       panel<span class="op">=</span><span class="va">panel.depth_function</span>,</span></span>
<span class="r-in"><span>       prepanel<span class="op">=</span><span class="va">prepanel.depth_function</span>,</span></span>
<span class="r-in"><span>       scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="slab-2.png" alt="" width="700" height="1133"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## categorical variable example</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="depths.html">depths</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> This is already a SoilProfileCollection-class object, doing nothing.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># normalize horizon names: result is a factor</span></span></span>
<span class="r-in"><span><span class="va">sp1</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="generalize.hz.html">generalize.hz</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">sp1</span><span class="op">$</span><span class="va">name</span>,</span></span>
<span class="r-in"><span>  new <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'O'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  pat <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'O'</span>, <span class="st">'^A'</span>,<span class="st">'^B'</span>,<span class="st">'C'</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compute slice-wise probability so that it sums to contributing fraction, from 0-150</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp1</span>, fm<span class="op">=</span> <span class="op">~</span> <span class="va">name</span>, cpm<span class="op">=</span><span class="fl">1</span>, slab.structure<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">150</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> horizons with zero thickness have been omitted from results</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># convert wide -&gt; long for plotting</span></span></span>
<span class="r-in"><span><span class="co"># result is a data.table</span></span></span>
<span class="r-in"><span><span class="co"># genhz factor levels are set by order in `measure.vars`</span></span></span>
<span class="r-in"><span><span class="va">a.long</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  id.vars <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'top'</span>,<span class="st">'bottom'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  measure.vars <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'O'</span>, <span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot horizon type proportions using panels</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">top</span> <span class="op">~</span> <span class="va">value</span> <span class="op">|</span> <span class="va">variable</span>,</span></span>
<span class="r-in"><span>       data <span class="op">=</span> <span class="va">a.long</span>, subset<span class="op">=</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>       col <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>       xlab <span class="op">=</span> <span class="st">'Class Probability'</span>,</span></span>
<span class="r-in"><span>       ylab <span class="op">=</span> <span class="st">'Depth (cm)'</span>,</span></span>
<span class="r-in"><span>       strip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/strip.default.html" class="external-link">strip.custom</a></span><span class="op">(</span>bg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.85</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       ylim <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span>, type<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'S'</span>,<span class="st">'g'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       horizontal <span class="op">=</span> <span class="cn">TRUE</span>, layout <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>       <span class="op">)</span></span></span>
<span class="r-plt img"><img src="slab-3.png" alt="" width="700" height="1133"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># again, this time using groups</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">top</span> <span class="op">~</span> <span class="va">value</span>,</span></span>
<span class="r-in"><span>       data <span class="op">=</span> <span class="va">a.long</span>,</span></span>
<span class="r-in"><span>       groups <span class="op">=</span> <span class="va">variable</span>,</span></span>
<span class="r-in"><span>       subset <span class="op">=</span> <span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>       ylab <span class="op">=</span> <span class="st">'Depth (cm)'</span>,</span></span>
<span class="r-in"><span>       ylim <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       type <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'S'</span>,<span class="st">'g'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       horizontal <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>       asp <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>       lwd <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>       auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>         lines <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>         points <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>         cex <span class="op">=</span> <span class="fl">0.8</span>,</span></span>
<span class="r-in"><span>         columns <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>         space <span class="op">=</span> <span class="st">'right'</span></span></span>
<span class="r-in"><span>       <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="slab-4.png" alt="" width="700" height="1133"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># adjust probability to size of collection, from 0-150</span></span></span>
<span class="r-in"><span><span class="va">a.1</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp1</span>, fm<span class="op">=</span> <span class="op">~</span> <span class="va">name</span>, cpm <span class="op">=</span> <span class="fl">2</span>, slab.structure <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">150</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> horizons with zero thickness have been omitted from results</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># convert wide -&gt; long for plotting</span></span></span>
<span class="r-in"><span><span class="co"># result is a data.table</span></span></span>
<span class="r-in"><span><span class="co"># genhz factor levels are set by order in `measure.vars`</span></span></span>
<span class="r-in"><span><span class="va">a.1.long</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">a.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  id.vars <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'top'</span>,<span class="st">'bottom'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  measure.vars <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'O'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># combine aggregation from `cpm` modes 1 and 2</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/make.groups.html" class="external-link">make.groups</a></span><span class="op">(</span>cmp.mode.1 <span class="op">=</span> <span class="va">a.long</span>, cmp.mode.2 <span class="op">=</span> <span class="va">a.1.long</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot horizon type proportions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">top</span> <span class="op">~</span> <span class="va">value</span> <span class="op">|</span> <span class="va">variable</span>,</span></span>
<span class="r-in"><span>       groups <span class="op">=</span> <span class="va">which</span>,</span></span>
<span class="r-in"><span>       data <span class="op">=</span> <span class="va">g</span>, subset <span class="op">=</span> <span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>       ylim <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">240</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       type <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'S'</span>,<span class="st">'g'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       horizontal <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>       layout <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="cn">TRUE</span>, points <span class="op">=</span> <span class="cn">FALSE</span>, columns <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>superpose.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       xlab <span class="op">=</span> <span class="st">'Class Probability'</span>,</span></span>
<span class="r-in"><span>       ylab <span class="op">=</span> <span class="st">'Depth (cm)'</span>,</span></span>
<span class="r-in"><span>       strip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/strip.default.html" class="external-link">strip.custom</a></span><span class="op">(</span>bg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.85</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="slab-5.png" alt="" width="700" height="1133"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># apply slice-wise evaluation of max probability, and assign ML-horizon at each slice</span></span></span>
<span class="r-in"><span><span class="va">gen.hz.ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="get.ml.hz.html">get.ml.hz</a></span><span class="op">(</span><span class="va">a</span>, <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'O'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## HD quantile estimator</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncss-tech/soilDB/" class="external-link">soilDB</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># sample data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'loafercreek'</span>, package <span class="op">=</span> <span class="st">'soilDB'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># defaul slab.fun wraps stats::quantile()</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">loafercreek</span>, fm <span class="op">=</span> <span class="op">~</span> <span class="va">total_frags_pct</span> <span class="op">+</span> <span class="va">clay</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use HD quantile estimator from Hmisc package instead</span></span></span>
<span class="r-in"><span><span class="va">a.HD</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">loafercreek</span>, fm <span class="op">=</span> <span class="op">~</span> <span class="va">total_frags_pct</span> <span class="op">+</span> <span class="va">clay</span>, slab.fun <span class="op">=</span> <span class="fu">aqp</span><span class="fu">:::</span><span class="va">.slab.fun.numeric.HD</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># combine</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/make.groups.html" class="external-link">make.groups</a></span><span class="op">(</span>standard<span class="op">=</span><span class="va">a</span>, HD<span class="op">=</span><span class="va">a.HD</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># note differences</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/histogram.html" class="external-link">densityplot</a></span><span class="op">(</span><span class="op">~</span> <span class="va">p.q50</span> <span class="op">|</span> <span class="va">variable</span>, data<span class="op">=</span><span class="va">g</span>, groups<span class="op">=</span><span class="va">which</span>,</span></span>
<span class="r-in"><span>            scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>relation<span class="op">=</span><span class="st">'free'</span>, alternating<span class="op">=</span><span class="fl">3</span>, tick.number<span class="op">=</span><span class="fl">10</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rot<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            xlab<span class="op">=</span><span class="st">'50th Percentile'</span>, pch<span class="op">=</span><span class="cn">NA</span>, main<span class="op">=</span><span class="st">'Loafercreek'</span>,</span></span>
<span class="r-in"><span>            auto.key<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>columns<span class="op">=</span><span class="fl">2</span>, points<span class="op">=</span><span class="cn">FALSE</span>, lines<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            par.settings<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>superpose.line<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'RoyalBlue'</span>, <span class="st">'Orange2'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># differences are slight but important</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">top</span> <span class="op">~</span> <span class="va">p.q50</span> <span class="op">|</span> <span class="va">variable</span>, data<span class="op">=</span><span class="va">g</span>, groups<span class="op">=</span><span class="va">which</span>,</span></span>
<span class="r-in"><span>  xlab<span class="op">=</span><span class="st">'Value'</span>, ylab<span class="op">=</span><span class="st">'Depth (cm)'</span>,</span></span>
<span class="r-in"><span>  asp<span class="op">=</span><span class="fl">1.5</span>, main<span class="op">=</span><span class="st">'Loafercreek'</span>,</span></span>
<span class="r-in"><span>  lower<span class="op">=</span><span class="va">g</span><span class="op">$</span><span class="va">p.q25</span>, upper<span class="op">=</span><span class="va">g</span><span class="op">$</span><span class="va">p.q75</span>,</span></span>
<span class="r-in"><span>  sync.colors<span class="op">=</span><span class="cn">TRUE</span>, alpha<span class="op">=</span><span class="fl">0.25</span>, cf<span class="op">=</span><span class="va">g</span><span class="op">$</span><span class="va">contributing_fraction</span>,</span></span>
<span class="r-in"><span>  ylim<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">115</span>,<span class="op">-</span><span class="fl">5</span><span class="op">)</span>, layout<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>relation<span class="op">=</span><span class="st">'free'</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  par.settings<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>superpose.line<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'RoyalBlue'</span>, <span class="st">'Orange2'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  strip<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/strip.default.html" class="external-link">strip.custom</a></span><span class="op">(</span>bg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.85</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  panel<span class="op">=</span><span class="va">panel.depth_function</span>,</span></span>
<span class="r-in"><span>  prepanel<span class="op">=</span><span class="va">prepanel.depth_function</span>,</span></span>
<span class="r-in"><span>  auto.key<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>columns<span class="op">=</span><span class="fl">2</span>, lines<span class="op">=</span><span class="cn">TRUE</span>, points<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## multivariate examples</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add new grouping factor</span></span></span>
<span class="r-in"><span><span class="va">sp3</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="st">'group 1'</span></span></span>
<span class="r-in"><span><span class="va">sp3</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">$</span><span class="va">id</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'group 2'</span></span></span>
<span class="r-in"><span><span class="va">sp3</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># upgrade to SPC</span></span></span>
<span class="r-in"><span><span class="fu"><a href="depths.html">depths</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span></span>
<span class="r-in"><span><span class="fu"><a href="site.html">site</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">group</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># custom 'slab' function, returning mean +/- 1SD</span></span></span>
<span class="r-in"><span><span class="va">mean.and.sd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">values</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">values</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">values</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="va">s</span></span></span>
<span class="r-in"><span>  <span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">-</span> <span class="va">s</span></span></span>
<span class="r-in"><span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span>mean<span class="op">=</span><span class="va">m</span>, lower<span class="op">=</span><span class="va">lower</span>, upper<span class="op">=</span><span class="va">upper</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># aggregate several variables at once, within 'group'</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp3</span>, fm <span class="op">=</span> <span class="va">group</span> <span class="op">~</span> <span class="va">L</span> <span class="op">+</span> <span class="va">A</span> <span class="op">+</span> <span class="va">B</span>, slab.fun <span class="op">=</span> <span class="va">mean.and.sd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check the results:</span></span></span>
<span class="r-in"><span><span class="co"># note that 'group' is the column containing group labels</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">top</span> <span class="op">~</span> <span class="va">mean</span> <span class="op">|</span> <span class="va">variable</span>, data<span class="op">=</span><span class="va">a</span>, groups<span class="op">=</span><span class="va">group</span>,</span></span>
<span class="r-in"><span>  lower<span class="op">=</span><span class="va">a</span><span class="op">$</span><span class="va">lower</span>, upper<span class="op">=</span><span class="va">a</span><span class="op">$</span><span class="va">upper</span>,</span></span>
<span class="r-in"><span>  sync.colors<span class="op">=</span><span class="cn">TRUE</span>, alpha<span class="op">=</span><span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  cf <span class="op">=</span> <span class="va">a</span><span class="op">$</span><span class="va">contributing_fraction</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="st">'Mean Bounded by +/- 1SD'</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="st">'Depth (cm)'</span>,</span></span>
<span class="r-in"><span>  ylim<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">125</span>,<span class="op">-</span><span class="fl">5</span><span class="op">)</span>, layout<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>relation<span class="op">=</span><span class="st">'free'</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>superpose.line<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'RoyalBlue'</span>, <span class="st">'Orange2'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  panel <span class="op">=</span> <span class="va">panel.depth_function</span>,</span></span>
<span class="r-in"><span>  prepanel <span class="op">=</span> <span class="va">prepanel.depth_function</span>,</span></span>
<span class="r-in"><span>  strip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/strip.default.html" class="external-link">strip.custom</a></span><span class="op">(</span>bg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.85</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>columns<span class="op">=</span><span class="fl">2</span>, lines<span class="op">=</span><span class="cn">TRUE</span>, points<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare a single profile to the group-level aggregate values</span></span></span>
<span class="r-in"><span><span class="va">a.1</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp3</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, fm <span class="op">=</span> <span class="va">group</span> <span class="op">~</span> <span class="va">L</span> <span class="op">+</span> <span class="va">A</span> <span class="op">+</span> <span class="va">B</span>, slab.fun <span class="op">=</span> <span class="va">mean.and.sd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># manually update the group column</span></span></span>
<span class="r-in"><span><span class="va">a.1</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="st">'profile 1'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># combine into a single data.frame:</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a.1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot with customized line styles</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">top</span> <span class="op">~</span> <span class="va">mean</span> <span class="op">|</span> <span class="va">variable</span>, data<span class="op">=</span><span class="va">g</span>, groups<span class="op">=</span><span class="va">group</span>, subscripts<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  lower<span class="op">=</span><span class="va">a</span><span class="op">$</span><span class="va">lower</span>, upper<span class="op">=</span><span class="va">a</span><span class="op">$</span><span class="va">upper</span>, ylim<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">125</span>,<span class="op">-</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  layout<span class="op">=</span><span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>relation<span class="op">=</span><span class="st">'free'</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="st">'Mean Bounded by +/- 1SD'</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="st">'Depth (cm)'</span>,</span></span>
<span class="r-in"><span>  panel<span class="op">=</span><span class="va">panel.depth_function</span>,</span></span>
<span class="r-in"><span>  prepanel<span class="op">=</span><span class="va">prepanel.depth_function</span>,</span></span>
<span class="r-in"><span>  sync.colors <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.25</span>,</span></span>
<span class="r-in"><span>  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    superpose.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      col <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'orange'</span>, <span class="st">'royalblue'</span>, <span class="st">'black'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  strip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/strip.default.html" class="external-link">strip.custom</a></span><span class="op">(</span>bg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.85</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>columns<span class="op">=</span><span class="fl">3</span>, lines<span class="op">=</span><span class="cn">TRUE</span>, points<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## again, this time for a user-defined slab from 40-60 cm</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp3</span>,</span></span>
<span class="r-in"><span>          fm <span class="op">=</span> <span class="va">group</span> <span class="op">~</span> <span class="va">L</span> <span class="op">+</span> <span class="va">A</span> <span class="op">+</span> <span class="va">B</span>,</span></span>
<span class="r-in"><span>          slab.structure <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">60</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          slab.fun <span class="op">=</span> <span class="va">mean.and.sd</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now we have weighted average properties (within the defined slab)</span></span></span>
<span class="r-in"><span><span class="co"># for each variable, and each group</span></span></span>
<span class="r-in"><span><span class="co"># convert long -&gt; wide</span></span></span>
<span class="r-in"><span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">group</span> <span class="op">+</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span> <span class="op">~</span> <span class="va">variable</span>,</span></span>
<span class="r-in"><span>  value.var <span class="op">=</span> <span class="st">'mean'</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## this time, compute the weighted mean of selected properties, by profile ID</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp3</span>,</span></span>
<span class="r-in"><span>          fm <span class="op">=</span> <span class="va">id</span> <span class="op">~</span> <span class="va">L</span> <span class="op">+</span> <span class="va">A</span> <span class="op">+</span> <span class="va">B</span>,</span></span>
<span class="r-in"><span>          slab.structure <span class="op">=</span> <span class="fu"><a href="combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">60</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          slab.fun <span class="op">=</span> <span class="va">mean.and.sd</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># convert long -&gt; wide</span></span></span>
<span class="r-in"><span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">id</span> <span class="op">+</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span> <span class="op">~</span> <span class="va">variable</span>,</span></span>
<span class="r-in"><span>  value.var <span class="op">=</span> <span class="st">'mean'</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## aggregate the entire collection, using default slab function</span></span></span>
<span class="r-in"><span><span class="co">## note the missing left-hand side of the formula</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">slab</span><span class="op">(</span><span class="va">sp3</span>, fm <span class="op">=</span> <span class="op">~</span> <span class="va">L</span> <span class="op">+</span> <span class="va">A</span> <span class="op">+</span> <span class="va">B</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Beaudette, Pierre Roudier, Andrew Brown, Stephen Roecker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

