<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Numerical Classification of Soil Profiles — NCSP • aqp</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Numerical Classification of Soil Profiles — NCSP"><meta name="description" content="Replacement for profile_compare().
Performs a numerical comparison of soil profiles using named properties,
based on a weighted, summed, depth-segment-aligned dissimilarity calculation.
Variability in soil depth can interfere significantly with the calculation
of between-profile dissimilarity–what is the numerical “distance” (or
dissimilarity) between a slice of soil from profile A and the corresponding,
but missing, slice from a shallower profile B? Gower's distance metric would
yield a NULL distance, despite the fact that intuition suggests otherwise:
shallower soils should be more dissimilar from deeper soils. For example,
when a 25 cm deep profile is compared with a 50 cm deep profile, numerical
distances are only accumulated for the first 25 cm of soil (distances from
26 - 50 cm are NULL). When summed, the total distance between these profiles
will generally be less than the distance between two profiles of equal
depth. Our algorithm will replace NULL
distances with the maximum distance between any pair of profiles for the
current depth slice. In this way, the numerical distance between a slice of
soil and a corresponding slice of non-soil reflects the fact that these two
materials should be treated very differently.
This alternative calculation of dissimilarities between soil and non-soil
slices solves the problem of comparing shallow profiles with deeper
profiles. However, it can result in a new problem: distances calculated
between two shallow profiles will be erroneously inflated beyond the extent
of either profile's depth. Our algorithm will preserve NULL distances between slices when
both slices represent non-soil material. Therefore, shallow
profiles will only accumulate mutual dissimilarity to the depth of the
deeper profile.
Slices are classified as 'soil' down to the maximum depth to which at least one of
variables used in the dissimilarity calculation is not NA. This will cause
problems when profiles within a collection contain all NAs within the
columns used to determine dissimilarity. An approach for identifying and
removing these kind of profiles is presented in the examples section below.
Our approach builds on the work of (Moore, 1972) and the previously
mentioned depth-slicing algorithm. See references below for a detailed explanation of the NCSP algorithm."><meta property="og:description" content="Replacement for profile_compare().
Performs a numerical comparison of soil profiles using named properties,
based on a weighted, summed, depth-segment-aligned dissimilarity calculation.
Variability in soil depth can interfere significantly with the calculation
of between-profile dissimilarity–what is the numerical “distance” (or
dissimilarity) between a slice of soil from profile A and the corresponding,
but missing, slice from a shallower profile B? Gower's distance metric would
yield a NULL distance, despite the fact that intuition suggests otherwise:
shallower soils should be more dissimilar from deeper soils. For example,
when a 25 cm deep profile is compared with a 50 cm deep profile, numerical
distances are only accumulated for the first 25 cm of soil (distances from
26 - 50 cm are NULL). When summed, the total distance between these profiles
will generally be less than the distance between two profiles of equal
depth. Our algorithm will replace NULL
distances with the maximum distance between any pair of profiles for the
current depth slice. In this way, the numerical distance between a slice of
soil and a corresponding slice of non-soil reflects the fact that these two
materials should be treated very differently.
This alternative calculation of dissimilarities between soil and non-soil
slices solves the problem of comparing shallow profiles with deeper
profiles. However, it can result in a new problem: distances calculated
between two shallow profiles will be erroneously inflated beyond the extent
of either profile's depth. Our algorithm will preserve NULL distances between slices when
both slices represent non-soil material. Therefore, shallow
profiles will only accumulate mutual dissimilarity to the depth of the
deeper profile.
Slices are classified as 'soil' down to the maximum depth to which at least one of
variables used in the dissimilarity calculation is not NA. This will cause
problems when profiles within a collection contain all NAs within the
columns used to determine dissimilarity. An approach for identifying and
removing these kind of profiles is presented in the examples section below.
Our approach builds on the work of (Moore, 1972) and the previously
mentioned depth-slicing algorithm. See references below for a detailed explanation of the NCSP algorithm."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aqp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/aqp-overview.html">An Overview of the aqp Package</a></li>
    <li><a class="dropdown-item" href="../articles/Introduction-to-SoilProfileCollection-Objects.html">Introduction to SoilProfileCollection Objects</a></li>
    <li><a class="dropdown-item" href="../articles/label-placement.html">Overlapping Annotation</a></li>
    <li><a class="dropdown-item" href="../articles/missing-data.html">Missing Data</a></li>
    <li><a class="dropdown-item" href="../articles/Munsell-color-conversion.html">Munsell Color Conversion</a></li>
    <li><a class="dropdown-item" href="../articles/NCSP.html">Numerical Classification of Soil Profiles</a></li>
    <li><a class="dropdown-item" href="../articles/new-in-aqp-2.html">What is new in aqp 2.x?</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncss-tech/aqp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Numerical Classification of Soil Profiles</h1>
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/aqp/blob/master/R/NCSP.R" class="external-link"><code>R/NCSP.R</code></a></small>
      <div class="d-none name"><code>NCSP.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Replacement for <code>profile_compare()</code>.</p>
<p>Performs a numerical comparison of soil profiles using named properties,
based on a weighted, summed, depth-segment-aligned dissimilarity calculation.</p>
<p>Variability in soil depth can interfere significantly with the calculation
of between-profile dissimilarity–what is the numerical “distance” (or
dissimilarity) between a slice of soil from profile A and the corresponding,
but missing, slice from a shallower profile B? Gower's distance metric would
yield a NULL distance, despite the fact that intuition suggests otherwise:
shallower soils should be more dissimilar from deeper soils. For example,
when a 25 cm deep profile is compared with a 50 cm deep profile, numerical
distances are only accumulated for the first 25 cm of soil (distances from
26 - 50 cm are NULL). When summed, the total distance between these profiles
will generally be less than the distance between two profiles of equal
depth. Our algorithm will replace NULL
distances with the maximum distance between any pair of profiles for the
current depth slice. In this way, the numerical distance between a slice of
soil and a corresponding slice of non-soil reflects the fact that these two
materials should be treated very differently.</p>
<p>This alternative calculation of dissimilarities between soil and non-soil
slices solves the problem of comparing shallow profiles with deeper
profiles. However, it can result in a new problem: distances calculated
between two shallow profiles will be erroneously inflated beyond the extent
of either profile's depth. Our algorithm will preserve NULL distances between slices when
both slices represent non-soil material. Therefore, shallow
profiles will only accumulate mutual dissimilarity to the depth of the
deeper profile.</p>
<p>Slices are classified as 'soil' down to the maximum depth to which at least one of
variables used in the dissimilarity calculation is not NA. This will cause
problems when profiles within a collection contain all NAs within the
columns used to determine dissimilarity. An approach for identifying and
removing these kind of profiles is presented in the examples section below.</p>
<p>Our approach builds on the work of (Moore, 1972) and the previously
mentioned depth-slicing algorithm. See references below for a detailed explanation of the NCSP algorithm.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">NCSP</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">vars</span>,</span>
<span>  fm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, times <span class="op">=</span> <span class="fu"><a href="length.html">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  maxDepth <span class="op">=</span> <span class="fu"><a href="max.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  isColor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  rescaleResult <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  returnDepthDistances <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p><code>SoilProfileColection</code> object, should be pre-filtered to remove profiles with horizon depth logic, see <code><a href="HzDepthLogicSubset.html">HzDepthLogicSubset</a></code></p></dd>


<dt id="arg-vars">vars<a class="anchor" aria-label="anchor" href="#arg-vars"></a></dt>
<dd><p>character vector, names of horizon attributes to use in the classification</p></dd>


<dt id="arg-fm">fm<a class="anchor" aria-label="anchor" href="#arg-fm"></a></dt>
<dd><p>formula, formula as specified to <code><a href="dice-SoilProfileCollection-method.html">dice()</a></code>, not yet implemented</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>numeric vector, same length as <code>vars</code>: variable importance weights, need not sum to 1</p></dd>


<dt id="arg-maxdepth">maxDepth<a class="anchor" aria-label="anchor" href="#arg-maxdepth"></a></dt>
<dd><p>numeric, maximum depth of analysis</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>numeric, weighting coefficient, usually between 0-1. A value of 0 results in no depth-weighting. See examples.</p></dd>


<dt id="arg-iscolor-">isColor, <a class="anchor" aria-label="anchor" href="#arg-iscolor-"></a></dt>
<dd><p>logical: variables represent color, should be CIELAB coordinates (D65 illuminant), weights are ignored. Variables should be named <code>L</code>, <code>A</code>, <code>B</code> in specified in that order.</p></dd>


<dt id="arg-rescaleresult">rescaleResult<a class="anchor" aria-label="anchor" href="#arg-rescaleresult"></a></dt>
<dd><p>logical, distance matrix is rescaled based on max(D)</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical, extra output messages</p></dd>


<dt id="arg-returndepthdistances">returnDepthDistances<a class="anchor" aria-label="anchor" href="#arg-returndepthdistances"></a></dt>
<dd><p>logical, return a list of distances by depth slice</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p><code>NCSP()</code> will overwrite the <code>removed.profiles</code> metadata from <code>x</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>J.J Maynard, S.W. Salley, D.E. Beaudette, J.E Herrick. Numerical soil classification supports soil identification by citizen scientists using limited, simple soil observations. Soil Sci. Soc. Am. J. 2020; 84: 1675-1692. <a href="https://doi.org/10.1002/saj2.20119" class="external-link">doi:10.1002/saj2.20119</a>
.</p></li>
<li><p>D.E. Beaudette, P. Roudier, A.T. O'Geen, Algorithms for quantitative pedology: A toolkit for soil scientists, Computers &amp; Geosciences, Volume 52, 2013, Pages 258-268, ISSN 0098-3004, <a href="https://doi.org/10.1016/j.cageo.2012.10.020" class="external-link">doi:10.1016/j.cageo.2012.10.020</a>
.</p></li>
<li><p>Moore, A.; Russell, J. &amp; Ward, W. Numerical analysis of soils: A comparison of three soil profile models with field classification. Journal of Soil Science, 1972, 23, 194-209.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="dice-SoilProfileCollection-method.html">dice()</a></code>, <code><a href="https://rdrr.io/pkg/cluster/man/daisy.html" class="external-link">cluster::daisy()</a></code>, <code><a href="compareSites.html">compareSites()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Dylan E. Beaudette and Jon Maynard</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Beaudette, Pierre Roudier, Andrew Brown.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

