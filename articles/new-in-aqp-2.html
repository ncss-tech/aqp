<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>What is new in aqp 2.x? • aqp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="What is new in aqp 2.x?">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aqp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/aqp-overview.html">An Overview of the aqp Package</a></li>
    <li><a class="dropdown-item" href="../articles/Introduction-to-SoilProfileCollection-Objects.html">Introduction to SoilProfileCollection Objects</a></li>
    <li><a class="dropdown-item" href="../articles/label-placement.html">Overlapping Annotation</a></li>
    <li><a class="dropdown-item" href="../articles/missing-data.html">Missing Data</a></li>
    <li><a class="dropdown-item" href="../articles/Munsell-color-conversion.html">Munsell Color Conversion</a></li>
    <li><a class="dropdown-item" href="../articles/NCSP.html">Numerical Classification of Soil Profiles</a></li>
    <li><a class="dropdown-item" href="../articles/new-in-aqp-2.html">What is new in aqp 2.x?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncss-tech/aqp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>What is new in aqp 2.x?</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/aqp/blob/master/vignettes/new-in-aqp-2.Rmd" class="external-link"><code>vignettes/new-in-aqp-2.Rmd</code></a></small>
      <div class="d-none name"><code>new-in-aqp-2.Rmd</code></div>
    </div>

    
    
<p>This is a major update to {aqp} that may create some issues for code
depending on specific inputs/outputs as of {aqp} &lt;= 1.42,
particularly those relying on <code><a href="../reference/slice.html">slice()</a></code>, <code><a href="../reference/slab.html">slab()</a></code>,
and <code>profile_compare()</code>. As of {aqp} 2.0,
<code><a href="../reference/slice.html">slice()</a></code> and <code>profile_compare()</code> are deprecated,
but will continue to work for the rest of calendar year 2023. There are
no plans to maintain these functions beyond {aqp} 2.0. The new version
of <code><a href="../reference/slab.html">slab()</a></code> is a drop-in replacement for the previous
version.</p>
<p>See the manual pages for <code><a href="../reference/dice-SoilProfileCollection-method.html">dice()</a></code>, <code><a href="../reference/NCSP.html">NCSP()</a></code>,
and <code><a href="../reference/slab.html">slab()</a></code>. Note that these new / updated functions perform
stricter tests for horizon depth logic errors. Messages and warnings are
issued when invalid depth logic is reported by
<code><a href="../reference/checkHzDepthLogic.html">checkHzDepthLogic()</a></code>. New functions
<code><a href="../reference/accumulateDepths.html">accumulateDepths()</a></code>, <code><a href="../reference/repairMissingHzDepths.html">repairMissingHzDepths()</a></code>,
and <code><a href="../reference/fillHzGaps.html">fillHzGaps()</a></code> can usually salvage problematic
profiles.</p>
<p>The <code>replace_na</code> and <code>add_soil_flag</code> arguments
to <code>profile_compare()</code> are not present in
<code><a href="../reference/NCSP.html">NCSP()</a></code>; missing data are always replaced by maximum
dissimilarity (1 when Gower’s distance metric is used) and the
soil/non-soil matrix is always used to compare profiles of different
depth.</p>
<div class="section level2">
<h2 id="notable-changes">Notable Changes<a class="anchor" aria-label="anchor" href="#notable-changes"></a>
</h2>
<ul>
<li>Deprecation of <code><a href="../reference/slice.html">slice()</a></code> in favor of the new, faster,
more robust implementation via <code><a href="../reference/dice-SoilProfileCollection-method.html">dice()</a></code>. Be sure to update
existing code to use <code><a href="../reference/dice-SoilProfileCollection-method.html">dice()</a></code> from now on. Some argument
names have changed.</li>
<li>Complete overhaul of <code><a href="../reference/slab.html">slab()</a></code> (thanks to <span class="citation">@brownag</span>), with new arguments, faster back-end,
and weighted aggregation implemented (finally).</li>
<li>Deprecation of <code>profile_compare()</code> in favor of the new
<code><a href="../reference/NCSP.html">NCSP()</a></code> function–a complete overhaul based on Maynard et
al., 2020. Note that:
<ul>
<li>site level attributes are now handled by
<code><a href="../reference/compareSites.html">compareSites()</a></code>
</li>
<li>variable weights are specified by argument</li>
</ul>
</li>
<li>The functions <code><a href="../reference/perturb.html">perturb()</a></code> and <code><a href="../reference/estimatePSCS.html">estimatePSCS()</a></code>
are now vectorized, and optimized for larger
<code>SoilProfileCollection</code> objects.</li>
<li>
<code><a href="../reference/mixMunsell.html">mixMunsell()</a></code> now uses
<code>mixingMethod = 'exact'</code> by default for the simulation of
subtractive color mixtures</li>
<li>
<code>gower</code> package moved to SUGGESTS</li>
<li>
<code><a href="../reference/plotColorMixture.html">plotColorMixture()</a></code> now using grid graphics functions to
determine color swatch geometry and setting overlap detection
threshold</li>
<li>Deprecation of <code><a href="../reference/rgb2munsell.html">rgb2munsell()</a></code> in favor of the more
general <code><a href="../reference/col2Munsell.html">col2Munsell()</a></code>
</li>
<li>Removal of <code>PMS2Munsell()</code> and support data</li>
<li>Deprecation of <code>coordinates()&lt;-</code> and
<code>proj4string()&lt;-</code> in favor of
<code>initSpatial()&lt;-</code>
</li>
<li>Removal of <code>rruff.sample</code> example XRD patterns</li>
<li>
<code><a href="../reference/get.ml.hz.html">get.ml.hz()</a></code> no longer uses the <code>name</code>
argument</li>
</ul>
</div>
<div class="section level2">
<h2 id="major-changes-to-plotspc">Major changes to <code>plotSPC()</code><a class="anchor" aria-label="anchor" href="#major-changes-to-plotspc"></a>
</h2>
<ul>
<li>The maximum depth range of the figure is now based on
<code>max.depth</code> or <code>max(x)</code>. This means that sketches
generated with {aqp} 2.x will generally have less white space at the
bottom of the figure. Make more room for additional annotation or visual
effect by setting the desired depth range with the
<code>max.depth</code> argument.</li>
<li>Now using the <code><a href="../reference/electroStatics_1D.html">electroStatics_1D()</a></code> method for fixing
horizon depth label overlap, solutions are deterministic and almost
always better. Adjust label overlap adjustment strategy with
<code>fixOverlapArgs = list(...)</code>.</li>
<li>Better depth axis interval heuristics (if not specified), varying
based on figure depth range.</li>
<li>Depth axis adjustments via new argument <code>depth.axis</code>,
logical or list</li>
<li>deprecation of arguments:
<ul>
<li>
<code>plot.depth.axis</code>: set via
<code>depth.axis = TRUE</code>, <code>depth.axis = FALSE</code>, or
customize <code>depth.axis = list(...)</code>
</li>
<li>
<code>cex.depth.axis</code>: set via
<code>depth.axis = list(cex = 1)</code>
</li>
<li>
<code>axis.line.offset</code>: set via
<code>depth.axis = list(line = -2)</code>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="new-features">New Features<a class="anchor" aria-label="anchor" href="#new-features"></a>
</h2>
<ul>
<li>New example data, <code>wilson2022</code>.</li>
<li>Fast prototyping of <code>SoilProfileCollection</code> objects via
<code><a href="../reference/quickSPC.html">quickSPC()</a></code> and list / character templates.</li>
<li>Re-use arguments to <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code> via setting
<code>options(.aqp.plotSPC.args = list(...))</code>. Set to
<code>options(.aqp.plotSPC.args = NULL)</code> to disable.</li>
<li>Coarse fragment classification via <code><a href="../reference/fragmentSieve.html">fragmentSieve()</a></code> and
<code><a href="../reference/fragmentClasses.html">fragmentClasses()</a></code>.</li>
<li>S4 <code>as.data.frame(&lt;SPC&gt;)</code> as shorthand for
<code>as(&lt;SPC&gt;, 'data.frame')</code>
</li>
<li>
<code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code> now marks truncated profiles with a ragged
bottom.</li>
<li>
<code><a href="../reference/fixOverlap.html">fixOverlap()</a></code> now has <a href="https://ncss-tech.github.io/aqp/articles/label-placement.html">two
label-placement solvers</a>:
<ul>
<li>electrostatic simulation (<code>method = "E"</code>)</li>
<li>simulated annealing (<code>method = "S"</code>)</li>
</ul>
</li>
<li>New <a href="https://ncss-tech.github.io/AQP/aqp/sketches.html" class="external-link">depth axis
styles</a> in <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code>.</li>
<li>New function <code><a href="../reference/flagOverlappingHz.html">flagOverlappingHz()</a></code> for identifying
horizons with perfect overlap</li>
<li>New function <code><a href="../reference/warpHorizons.html">warpHorizons()</a></code> for warping horizon
thickness (inflate/deflate)</li>
<li>
<code><a href="../reference/simulateColor.html">simulateColor()</a></code> adds multivariate simulation in CIELAB
colorspace</li>
</ul>
</div>
<div class="section level2">
<h2 id="incremental-changes-should-have-no-effect-on-previous-code">Incremental changes, should have no effect on previous code<a class="anchor" aria-label="anchor" href="#incremental-changes-should-have-no-effect-on-previous-code"></a>
</h2>
<ul>
<li>Bug fix in <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code> when
<code>fixLabelCollisions = TRUE</code>, adjustments suggested to
<code><a href="../reference/fixOverlap.html">fixOverlap()</a></code> are now scaled correctly.</li>
<li>
<code><a href="../reference/explainPlotSPC.html">explainPlotSPC()</a></code> reports label adjustment index when
label collision repair is enabled.</li>
<li>Aesthetic cleanup in <code><a href="../reference/explainPlotSPC.html">explainPlotSPC()</a></code>.</li>
<li>
<code><a href="../reference/soilColorSignature.html">soilColorSignature()</a></code> gains arguments and perceptual
color distances (dE00) via {farver} package.</li>
<li>
<code>as(&lt;SPC&gt;, "data.frame")</code>: Replace
<code>plyr::join()</code> with <code><a href="https://edzer.github.io/sp/reference/merge.html" class="external-link">merge()</a></code>.</li>
<li>
<code><a href="../reference/correctAWC.html">correctAWC()</a></code>: NA handling - return NA when frags are
NA.</li>
<li>
<code><a href="../reference/mutate_profile.html">mutate_profile()</a></code>: Faster (data.table-based) evaluation
of profile-level expressions.</li>
<li>
<code>profileApply</code>: Add support for custom
<code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>-like function (<code>APPLY.FUN</code>) for
processing chunks.</li>
<li>Add <code>.interpretHorizonColor()</code> outputs to
<code>last_spc_plot</code> in <code>aqp.env</code> for use in custom
<code><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend()</a></code>.</li>
<li>Add <code>simplify</code> argument to
<code><a href="../reference/SoilTextureLevels.html">SoilTextureLevels()</a></code> and <code><a href="../reference/texture.html">ssc_to_texcl()</a></code> to
optionally convert to an ordered factor with maximum of 12 levels
(rather than 21). This smaller list of classes excludes sand grain size
variants such as fine sand, loamy coarse sand, and very fine sandy
loam.</li>
<li>Major updates to <code><a href="../reference/profileInformationIndex.html">profileInformationIndex()</a></code> methods and
performance boost.</li>
<li>Enhancements to <code><a href="../reference/evalMissingData.html">evalMissingData()</a></code>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Beaudette, Pierre Roudier, Andrew Brown, Stephen Roecker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
