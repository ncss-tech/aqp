<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to SoilProfileCollection Objects • aqp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to SoilProfileCollection Objects">
<meta property="og:description" content="aqp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">aqp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction-to-SoilProfileCollection-Objects.html">Introduction to SoilProfileCollection Objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ncss-tech/aqp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Introduction-to-SoilProfileCollection-Objects_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to SoilProfileCollection Objects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/aqp/blob/HEAD/vignettes/Introduction-to-SoilProfileCollection-Objects.Rmd" class="external-link"><code>vignettes/Introduction-to-SoilProfileCollection-Objects.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction-to-SoilProfileCollection-Objects.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This is a basic introduction to the <code>SoilProfileCollection</code> class object defined in the <code>aqp</code> package for <strong>R</strong>.</p>
<p>The <code>SoilProfileCollection</code> class was designed to simplify the process of working with the collection of data associated with soil profiles: site-level data, horizon-level data, spatial data, diagnostic horizon data, metadata, etc.</p>
<p>Examples listed below are meant to be copied/pasted from this document and interactively run within <strong>R</strong>. Comments (preceded by <code>#</code> symbol) briefly describe what the code in each line does. Further documentation on objects and functions from the <code>aqp</code> package can be accessed by typing <code><a href="../reference/aqp-package.html">help(aqp)</a></code> (or more generally, <code>?function_name</code>) at the <strong>R</strong> console.</p>
</div>
<div class="section level2">
<h2 id="object-creation">Object Creation<a class="anchor" aria-label="anchor" href="#object-creation"></a>
</h2>
<p><code>SoilProfileCollection</code> objects are typically created by “promoting” <code>data.frame</code> objects (rectangular tables of data) that contain at least three essential columns:</p>
<ol style="list-style-type: decimal">
<li>an ID column uniquely identifying groups of horizons (e.g. pedons)</li>
<li>horizon top boundaries</li>
<li>horizon bottom boundaries</li>
</ol>
<p>The <code>data.frame</code> is sorted internally according to the profile ID and horizon top boundary. Formula notation is used to define the columns used to promote a <code>data.frame</code> object:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idcolumn</span> <span class="op">~</span> <span class="va">hz_top_column</span> <span class="op">+</span> <span class="va">hz_bottom_column</span></span></code></pre></div>
<p>In this tutorial we will use some sample data included with the <code>aqp</code> package, based on characterization data from 10 soils sampled on serpentinitic parent material as described in <a href="https://www.soils.org/publications/sssaj/articles/73/6/2087" class="external-link">McGahan et al, 2009</a>.</p>
<p>To begin you will load required packages. You may have to first install these if missing:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install CRAN release + dependencies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'aqp'</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># install latest version from GitHub</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ncss-tech/aqp"</span>, dependencies <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncss-tech/aqp" class="external-link">aqp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load sample data set, a data.frame object with horizon-level data from 10 profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    30 obs. of  13 variables:</span></span>
<span><span class="co">#&gt;  $ id         : chr  "colusa" "colusa" "colusa" "colusa" ...</span></span>
<span><span class="co">#&gt;  $ name       : chr  "A" "ABt" "Bt1" "Bt2" ...</span></span>
<span><span class="co">#&gt;  $ top        : int  0 3 8 30 0 9 0 4 13 0 ...</span></span>
<span><span class="co">#&gt;  $ bottom     : int  3 8 30 42 9 34 4 13 40 6 ...</span></span>
<span><span class="co">#&gt;  $ K          : num  0.3 0.2 0.1 0.1 0.2 0.3 0.2 0.6 0.8 0.4 ...</span></span>
<span><span class="co">#&gt;  $ Mg         : num  25.7 23.7 23.2 44.3 21.9 18.9 12.1 12.1 17.7 16.4 ...</span></span>
<span><span class="co">#&gt;  $ Ca         : num  9 5.6 1.9 0.3 4.4 4.5 1.4 7 4.4 24.1 ...</span></span>
<span><span class="co">#&gt;  $ CEC_7      : num  23 21.4 23.7 43 18.8 27.5 23.7 18 20 31.1 ...</span></span>
<span><span class="co">#&gt;  $ ex_Ca_to_Mg: num  0.35 0.23 0.08 0.01 0.2 0.2 0.58 0.51 0.25 1.47 ...</span></span>
<span><span class="co">#&gt;  $ sand       : int  46 42 40 27 54 49 43 36 27 43 ...</span></span>
<span><span class="co">#&gt;  $ silt       : int  33 31 28 18 20 18 55 49 45 42 ...</span></span>
<span><span class="co">#&gt;  $ clay       : int  21 27 32 55 25 34 3 15 27 15 ...</span></span>
<span><span class="co">#&gt;  $ CF         : num  0.12 0.27 0.27 0.16 0.55 0.84 0.5 0.75 0.67 0.02 ...</span></span>
<span></span>
<span><span class="co"># optionally read about it...</span></span>
<span><span class="co"># ?sp4</span></span>
<span></span>
<span><span class="co"># upgrade to SoilProfileCollection</span></span>
<span><span class="co"># 'id' is the name of the column containing the profile ID</span></span>
<span><span class="co"># 'top' is the name of the column containing horizon upper boundaries</span></span>
<span><span class="co"># 'bottom' is the name of the column containing horizon lower boundaries</span></span>
<span><span class="fu">depths</span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span>
<span></span>
<span><span class="co"># define "horizon designation" column name for the collection</span></span>
<span><span class="fu"><a href="../reference/hzdesgnname.html">hzdesgnname</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'name'</span></span>
<span></span>
<span><span class="co"># check it out:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "SoilProfileCollection"</span></span>
<span><span class="co">#&gt; attr(,"package")</span></span>
<span><span class="co">#&gt; [1] "aqp"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="co">#&gt; SoilProfileCollection with 10 profiles and 30 horizons</span></span>
<span><span class="co">#&gt; profile ID: id  |  horizon ID: hzID </span></span>
<span><span class="co">#&gt; Depth range: 16 - 49 cm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ----- Horizons (6 / 30 rows  |  10 / 14 columns) -----</span></span>
<span><span class="co">#&gt;      id hzID top bottom name   K   Mg  Ca CEC_7 ex_Ca_to_Mg</span></span>
<span><span class="co">#&gt;  colusa    1   0      3    A 0.3 25.7 9.0  23.0        0.35</span></span>
<span><span class="co">#&gt;  colusa    2   3      8  ABt 0.2 23.7 5.6  21.4        0.23</span></span>
<span><span class="co">#&gt;  colusa    3   8     30  Bt1 0.1 23.2 1.9  23.7        0.08</span></span>
<span><span class="co">#&gt;  colusa    4  30     42  Bt2 0.1 44.3 0.3  43.0        0.01</span></span>
<span><span class="co">#&gt;   glenn    5   0      9    A 0.2 21.9 4.4  18.8        0.20</span></span>
<span><span class="co">#&gt;   glenn    6   9     34   Bt 0.3 18.9 4.5  27.5        0.20</span></span>
<span><span class="co">#&gt; [... more horizons ...]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ----- Sites (6 / 10 rows  |  1 / 1 columns) -----</span></span>
<span><span class="co">#&gt;         id</span></span>
<span><span class="co">#&gt;     colusa</span></span>
<span><span class="co">#&gt;      glenn</span></span>
<span><span class="co">#&gt;      kings</span></span>
<span><span class="co">#&gt;   mariposa</span></span>
<span><span class="co">#&gt;  mendocino</span></span>
<span><span class="co">#&gt;       napa</span></span>
<span><span class="co">#&gt; [... more sites ...]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Spatial Data:</span></span>
<span><span class="co">#&gt; [EMPTY]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="accessing-setting-and-replacing-data">Accessing, Setting, and Replacing Data<a class="anchor" aria-label="anchor" href="#accessing-setting-and-replacing-data"></a>
</h2>
<p>“Accessor” functions are used to extract specific components from within <code>SoilProfileCollection</code> objects.</p>
<ul>
<li>
<p>Methods that return a column name. These are useful for extracting depths, horizon designations, IDs, etc. before taking an SPC apart for a specific task.</p>
<ul>
<li>
<code>idname(sp4)</code>: extract profile ID name (column name used to init SPC)</li>
<li>
<code>horizonDepths(sp4)</code>: horizon top / bottom depth names (used to init SPC)</li>
<li>
<code>hzidname(sp4)</code>: horizon ID name (typically automatically built at init time)</li>
<li>
<code>hzdesgnname(sp4)</code>: horizon designation name (if set)</li>
<li>
<code>hztexclname(sp4)</code>: horizon texture class name (if set)</li>
</ul>
</li>
<li>
<p>Methods that return a vector of values.</p>
<ul>
<li>
<code>profile_id(sp4)</code>: profile IDs, in order</li>
<li>
<code>hzID(sp4)</code>: horizon IDs, in order</li>
<li>
<code>hzDesgn(sp4)</code>: horizon designations, in order</li>
</ul>
</li>
<li>
<p>Methods that return site/horizon attribute column names.</p>
<ul>
<li>
<code>names(sp4)</code>: site + horizon names concatenated into a single vector</li>
<li>
<code>horizonNames(sp4)</code>: horizon names</li>
<li>
<code>siteNames(sp4)</code>: site names</li>
</ul>
</li>
<li>
<p>Profile and horizon totals.</p>
<ul>
<li>
<code>length(sp4)</code>: number of profiles in collection</li>
<li>
<code>nrow(sp4)</code>: number of horizons in collection</li>
</ul>
</li>
<li>
<p>Other methods.</p>
<ul>
<li>
<code>depth_units(sp4)</code>: defaults to ‘cm’ at SPC creation</li>
<li>
<code>metadata(sp4)</code>: returns <code>list</code> object with base + optional (user-defined) metadata elements</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="horizon-and-site-data">Horizon and Site Data<a class="anchor" aria-label="anchor" href="#horizon-and-site-data"></a>
</h2>
<p>Horizon data and information about key columns (unique profile ID and depths) are the primary input to the methods provided to create the object. Site data can be derived from unique profile-specific values within the input horizon data, or joined in from an external source based on profile ID.</p>
<p>Both site and horizon data are stored as <code>data.frame</code> within the SoilProfileCollection; with one or more rows (per profile ID) in the horizon table and one row (per profile ID) in the site table. The SoilProfileCollection also supports <code>data.table</code>, or <code>tibble</code> objects in the <code>data.frame</code> slots.</p>
<p>Columns from site or horizon tables can be accessed with the <code>$</code> syntax notation, similar to the <code>data.frame</code>. New data can be assigned to either table in the same manner, as long as the length of the new data is:</p>
<ol style="list-style-type: decimal">
<li>same length as the number of profiles in the collection (target is the site table)</li>
<li>same length as the number of horizons in the collection (target is the horizon table)</li>
<li>length 1; and selecting the target table requires <code>site(object)$new_column &lt;- new_value</code> for new site data and <code>horizons(object)$new_column &lt;- new value</code> for horizon</li>
</ol>
<p>Assignment of new data to existing or new attributes can proceed as follows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># site-level (based on length of assigned data == number of profiles)</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">1000</span>, sd <span class="op">=</span> <span class="fl">150</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># horizon-level (calculated from two horizon-level columns)</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">thickness</span> <span class="op">&lt;-</span> <span class="va">sp4</span><span class="op">$</span><span class="va">bottom</span> <span class="op">-</span> <span class="va">sp4</span><span class="op">$</span><span class="va">top</span> </span>
<span></span>
<span><span class="co"># extraction of specific attributes by name</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">clay</span> <span class="co"># vector of clay content (horizon data)</span></span>
<span><span class="co">#&gt;  [1] 21 27 32 55 25 34  3 15 27 32 25 31 33 13 21 23 15 17 12 19 14 14 22 25 40 51 67 24 25 32</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">elevation</span> <span class="co"># vector of simulated elevation (site data)</span></span>
<span><span class="co">#&gt;  [1] 1053.6601 1098.4831  900.3864  839.4096  858.2950 1009.2629 1141.4762  998.7721  848.8380</span></span>
<span><span class="co">#&gt; [10] 1150.6093</span></span>
<span></span>
<span><span class="co"># unit-length value explicitly targeting site data</span></span>
<span><span class="fu"><a href="../reference/site.html">site</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">$</span><span class="va">collection_id</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># assign a single single value into horizon-level attributes</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">constant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, times <span class="op">=</span> <span class="fu"><a href="../reference/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># unit-length value explicitly targeting horizon data</span></span>
<span><span class="fu"><a href="../reference/horizons.html">horizons</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">$</span><span class="va">analysis_group</span> <span class="op">&lt;-</span> <span class="st">"SERP"</span></span>
<span></span>
<span><span class="co"># _moves_ the named column from horizon to site</span></span>
<span><span class="fu"><a href="../reference/site.html">site</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">constant</span> </span></code></pre></div>
<p>Horizon and site data can be modified via extraction to <code>data.frame</code> followed by replacement (horizon data) or join (site data). Note that while this approach gives the most flexibility, it is also the most dangerous–replacement of horizon data with new data that don’t exactly conform to the original sorting may corrupt your <code>SoilProfileCollection</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract horizon data to data.frame</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/horizons.html">horizons</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add a new column and save back to original object</span></span>
<span><span class="va">h</span><span class="op">$</span><span class="va">random.numbers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="../reference/nrow.html">nrow</a></span><span class="op">(</span><span class="va">h</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># _replace_ original horizon data with modified version</span></span>
<span><span class="fu">replaceHorizons</span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">h</span></span>
<span></span>
<span><span class="co"># extract site data to data.frame</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/site.html">site</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add a fake group to the site data</span></span>
<span><span class="va">s</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'B'</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fu"><a href="../reference/nrow.html">nrow</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join new site data with previous data: old data are _not_ replaced</span></span>
<span><span class="fu"><a href="../reference/site.html">site</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">s</span></span>
<span></span>
<span><span class="co"># check</span></span>
<span><span class="va">sp4</span></span>
<span><span class="co">#&gt; SoilProfileCollection with 10 profiles and 30 horizons</span></span>
<span><span class="co">#&gt; profile ID: id  |  horizon ID: hzID </span></span>
<span><span class="co">#&gt; Depth range: 16 - 49 cm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ----- Horizons (6 / 30 rows  |  10 / 17 columns) -----</span></span>
<span><span class="co">#&gt;      id hzID top bottom name   K   Mg  Ca CEC_7 ex_Ca_to_Mg</span></span>
<span><span class="co">#&gt;  colusa    1   0      3    A 0.3 25.7 9.0  23.0        0.35</span></span>
<span><span class="co">#&gt;  colusa    2   3      8  ABt 0.2 23.7 5.6  21.4        0.23</span></span>
<span><span class="co">#&gt;  colusa    3   8     30  Bt1 0.1 23.2 1.9  23.7        0.08</span></span>
<span><span class="co">#&gt;  colusa    4  30     42  Bt2 0.1 44.3 0.3  43.0        0.01</span></span>
<span><span class="co">#&gt;   glenn    5   0      9    A 0.2 21.9 4.4  18.8        0.20</span></span>
<span><span class="co">#&gt;   glenn    6   9     34   Bt 0.3 18.9 4.5  27.5        0.20</span></span>
<span><span class="co">#&gt; [... more horizons ...]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ----- Sites (6 / 10 rows  |  5 / 5 columns) -----</span></span>
<span><span class="co">#&gt;         id elevation collection_id constant group</span></span>
<span><span class="co">#&gt;     colusa 1053.6601             1        1     A</span></span>
<span><span class="co">#&gt;      glenn 1098.4831             1        1     B</span></span>
<span><span class="co">#&gt;      kings  900.3864             1        1     A</span></span>
<span><span class="co">#&gt;   mariposa  839.4096             1        1     B</span></span>
<span><span class="co">#&gt;  mendocino  858.2950             1        1     A</span></span>
<span><span class="co">#&gt;       napa 1009.2629             1        1     B</span></span>
<span><span class="co">#&gt; [... more sites ...]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Spatial Data:</span></span>
<span><span class="co">#&gt; [EMPTY]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="diagnostic-horizons">Diagnostic Horizons<a class="anchor" aria-label="anchor" href="#diagnostic-horizons"></a>
</h2>
<p>Diagnostic horizons typically span several genetic horizons and may or may not be present in every profile.</p>
<p>To accommodate the wide range of possibilities, diagnostic horizon data are stored as a <code>data.frame</code> in “long format”: each row corresponds to a diagnostic feature in a single profile, identified with a column matching the ID column used to initialize the <code>SoilProfileCollection</code> object and a label reflecting the feature kind.</p>
<p>For diagnostic horizon data there are no restrictions on data content, as long as each row has an ID that exists within the collection. Be sure to use the ID column name that was used to initialize the SoilProfileCollection object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">'colusa'</span>,</span>
<span>  kind <span class="op">=</span> <span class="st">'argillic'</span>,</span>
<span>  top <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  bottom <span class="op">=</span> <span class="fl">42</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># overwrite any existing diagnostic horizon data</span></span>
<span><span class="fu"><a href="../reference/diagnostic_hz.html">diagnostic_hz</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dh</span></span>
<span></span>
<span><span class="co"># append to diagnostic horizon data</span></span>
<span><span class="va">dh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diagnostic_hz.html">diagnostic_hz</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="va">dh.new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">'napa'</span>,</span>
<span>  kind <span class="op">=</span> <span class="st">'argillic'</span>,</span>
<span>  top <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  bottom <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># overwrite existing diagnostic horizon data with appended data</span></span>
<span><span class="fu"><a href="../reference/diagnostic_hz.html">diagnostic_hz</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dh</span>, <span class="va">dh.new</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="root-restrictive-features">Root Restrictive Features<a class="anchor" aria-label="anchor" href="#root-restrictive-features"></a>
</h2>
<p>Features that restrict root entry (fine or very fine roots) are commonly used to estimate <em>functional</em> soil depth. Restrictive features include salt accumulations, duripans, fragipans, paralithic matrials, lithic contact, or an abrupt change in chemical property.</p>
<p>Not all soils have restrictive features, therefore these data are stored as a <code>data.frame</code> in “long format”. Each row corresponds to a restrictive feature, associated depths, and identified by <code><a href="../reference/profile_id.html">profile_id()</a></code>. There may be more than one restrictive feature per soil profile.</p>
<p>The example data <code>sp4</code> does not describe the restrictive features, so we will simulate some at the bottom of each profile + 20cm.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the depth of each profile</span></span>
<span><span class="va">rf.top</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="va">max</span><span class="op">)</span></span>
<span><span class="va">rf.bottom</span> <span class="op">&lt;-</span> <span class="va">rf.top</span> <span class="op">+</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># the profile IDs can be extracted from the names attribute</span></span>
<span><span class="va">pIDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/names.html">names</a></span><span class="op">(</span><span class="va">rf.top</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note: profile IDs must be stored in a column named for idname(sp4) -&gt; 'id'</span></span>
<span><span class="va">rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="va">pIDs</span>, </span>
<span>  top <span class="op">=</span> <span class="va">rf.top</span>, </span>
<span>  bottom <span class="op">=</span> <span class="va">rf.bottom</span>, </span>
<span>  kind <span class="op">=</span> <span class="st">'fake'</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># overwrite any existing diagnostic horizon data</span></span>
<span><span class="fu"><a href="../reference/restrictions.html">restrictions</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rf</span></span>
<span></span>
<span><span class="co"># check</span></span>
<span><span class="fu"><a href="../reference/restrictions.html">restrictions</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="co">#&gt;                id top bottom kind</span></span>
<span><span class="co">#&gt; 1          colusa  42     62 fake</span></span>
<span><span class="co">#&gt; 2           glenn  34     54 fake</span></span>
<span><span class="co">#&gt; 3           kings  40     60 fake</span></span>
<span><span class="co">#&gt; 4        mariposa  49     69 fake</span></span>
<span><span class="co">#&gt; 5       mendocino  30     50 fake</span></span>
<span><span class="co">#&gt; 6            napa  20     40 fake</span></span>
<span><span class="co">#&gt; 7      san benito  20     40 fake</span></span>
<span><span class="co">#&gt; 8          shasta  40     60 fake</span></span>
<span><span class="co">#&gt; 9  shasta-trinity  40     60 fake</span></span>
<span><span class="co">#&gt; 10         tehama  16     36 fake</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spatial-data">Spatial Data<a class="anchor" aria-label="anchor" href="#spatial-data"></a>
</h2>
<p>Spatial data can be explicitly stored within a <code>SoilProfileCollection</code> object and accessed with methods imported from the <a href="http://cran.at.r-project.org/web/packages/sp/index.html" class="external-link">sp</a> package.</p>
<p>The use of <code>sp</code> classes (in this case <code>SpatialPoints</code> and <code>SpatialPointsDataFrame</code> objects) simplifies operations such as <a href="http://cran.at.r-project.org/web/packages/sp/vignettes/intro_sp.pdf" class="external-link">plotting spatial data, coordinate system transformations, and spatial queries</a>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate some fake coordinates as site level attributes</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">354000</span>, sd <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">4109533</span>, sd <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initialize spatial coordinates</span></span>
<span><span class="fu"><a href="../reference/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span></span>
<span><span class="co"># extract coordinates as matrix</span></span>
<span><span class="fu"><a href="../reference/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="co">#&gt;           x       y</span></span>
<span><span class="co">#&gt; 1  353957.5 4109574</span></span>
<span><span class="co">#&gt; 2  353960.2 4109547</span></span>
<span><span class="co">#&gt; 3  354022.1 4109584</span></span>
<span><span class="co">#&gt; 4  353919.2 4109571</span></span>
<span><span class="co">#&gt; 5  354007.6 4109287</span></span>
<span><span class="co">#&gt; 6  354051.9 4109295</span></span>
<span><span class="co">#&gt; 7  354061.2 4109471</span></span>
<span><span class="co">#&gt; 8  353822.9 4109547</span></span>
<span><span class="co">#&gt; 9  353875.3 4109570</span></span>
<span><span class="co">#&gt; 10 354027.3 4109726</span></span>
<span></span>
<span><span class="co"># get/set spatial reference system using PROJ4 syntax</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html" class="external-link">proj4string</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'+proj=utm +zone=11 +datum=NAD83'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html" class="external-link">proj4string</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "+proj=utm +zone=11 +datum=NAD83"</span></span>
<span></span>
<span><span class="co"># extract spatial data + site level attribtutes</span></span>
<span><span class="co"># see ?SpatialPointsDataFrame for details</span></span>
<span><span class="va">sp4.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coercion-methods.html">as</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="st">'SpatialPointsDataFrame'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="object-metadata">Object Metadata<a class="anchor" aria-label="anchor" href="#object-metadata"></a>
</h2>
<p>SoilProfileCollection metadata can be extracted and set using the <code><a href="../reference/metadata.html">metadata()</a></code> and <code>metadata&lt;-</code> methods.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># metadata structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/metadata.html">metadata</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 7</span></span>
<span><span class="co">#&gt;  $ aqp_df_class    : chr "data.frame"</span></span>
<span><span class="co">#&gt;  $ aqp_group_by    : chr ""</span></span>
<span><span class="co">#&gt;  $ aqp_hzdesgn     : chr "name"</span></span>
<span><span class="co">#&gt;  $ aqp_hztexcl     : chr ""</span></span>
<span><span class="co">#&gt;  $ depth_units     : chr "cm"</span></span>
<span><span class="co">#&gt;  $ stringsAsFactors: logi FALSE</span></span>
<span><span class="co">#&gt;  $ original.order  : int [1:30] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span></span>
<span><span class="co"># alter the depth unit metadata attribute</span></span>
<span><span class="fu"><a href="../reference/depth_units.html">depth_units</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'inches'</span> <span class="co"># units are really 'cm'</span></span>
<span></span>
<span><span class="co"># add or replace custom metadata</span></span>
<span><span class="fu"><a href="../reference/metadata.html">metadata</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">$</span><span class="va">describer</span> <span class="op">&lt;-</span> <span class="st">'DGM'</span></span>
<span><span class="fu"><a href="../reference/metadata.html">metadata</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2009-01-01'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/metadata.html">metadata</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">$</span><span class="va">citation</span> <span class="op">&lt;-</span> <span class="st">'McGahan, D.G., Southard, R.J, Claassen, V.P. 2009. Plant-Available Calcium Varies Widely in Soils on Serpentinite Landscapes. Soil Sci. Soc. Am. J. 73: 2087-2095.'</span></span>
<span></span>
<span><span class="co"># check new values have been added</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/metadata.html">metadata</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 10</span></span>
<span><span class="co">#&gt;  $ aqp_df_class    : chr "data.frame"</span></span>
<span><span class="co">#&gt;  $ aqp_group_by    : chr ""</span></span>
<span><span class="co">#&gt;  $ aqp_hzdesgn     : chr "name"</span></span>
<span><span class="co">#&gt;  $ aqp_hztexcl     : chr ""</span></span>
<span><span class="co">#&gt;  $ depth_units     : chr "inches"</span></span>
<span><span class="co">#&gt;  $ stringsAsFactors: logi FALSE</span></span>
<span><span class="co">#&gt;  $ original.order  : int [1:30] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ describer       : chr "DGM"</span></span>
<span><span class="co">#&gt;  $ date            : Date[1:1], format: "2009-01-01"</span></span>
<span><span class="co">#&gt;  $ citation        : chr "McGahan, D.G., Southard, R.J, Claassen, V.P. 2009. Plant-Available Calcium Varies Widely in Soils on Serpentini"| __truncated__</span></span>
<span></span>
<span><span class="co"># fix depth units, set back to 'cm'</span></span>
<span><span class="fu"><a href="../reference/depth_units.html">depth_units</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'cm'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="validity-and-horizon-logic">Validity and Horizon Logic<a class="anchor" aria-label="anchor" href="#validity-and-horizon-logic"></a>
</h2>
<p>There are several SoilProfileCollection methods defined to identify corrupted objects/bad depth logic and fix them.</p>
<p>Usually an “invalid” or “corrupt” SoilProfileCollection comes from direct modification of the S4 object slot contents (not using standard methods), which can result in omissions or reordering that bypasses internal accounting methods.</p>
<p>Occasionally issues arise from illogical inputs (depths) or collections that are missing data. The latter cases (standard methods produce a corrupt SPC given some “degenerate” input data) are considered “bugs” that should reported on the issue tracker: <a href="https://github.com/ncss-tech/aqp/issues" class="external-link uri">https://github.com/ncss-tech/aqp/issues</a></p>
<p><code><a href="../reference/checkSPC.html">checkSPC()</a></code> returns TRUE for a SoilProfileCollection that contains all slots defined in the class prototype.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/checkSPC.html">checkSPC</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/spc_in_sync.html">spc_in_sync()</a></code> is used as the validity method for the SoilProfileCollection, it determines if some reordering of the horizon data relative to the unique profile ID / site order has occurred.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spc_in_sync.html">spc_in_sync</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   nSites relativeOrder valid</span></span>
<span><span class="co">#&gt; 1   TRUE          TRUE  TRUE</span></span></code></pre></div>
<p><code><a href="../reference/rebuildSPC.html">rebuildSPC()</a></code> is used to re-construct all the required slots of a SoilProfileCollection, given a source, possibly corrupt, object. This function fixes major issues related to the internal ordering of data in slots, as well as missing slots or metadata.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rebuildSPC.html">rebuildSPC</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/checkHzDepthLogic.html">checkHzDepthLogic()</a></code> has the ability to perform logical tests on whole profiles or individual horizons. Four different tests are performed related to four common errors in horizon depths:</p>
<ul>
<li><p>bottom depth shallower than top depth</p></li>
<li><p>equal top and bottom depth</p></li>
<li><p>missing (<code>NA</code>) top or bottom depth</p></li>
<li><p>gap or overlap between adjacent horizons</p></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/checkHzDepthLogic.html">checkHzDepthLogic</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="co">#&gt;                id valid depthLogic sameDepth missingDepth overlapOrGap</span></span>
<span><span class="co">#&gt; 1          colusa  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 2           glenn  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 3           kings  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 4        mariposa  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 5       mendocino  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 6            napa  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 7      san benito  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 8          shasta  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 9  shasta-trinity  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 10         tehama  TRUE      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="fu"><a href="../reference/checkHzDepthLogic.html">checkHzDepthLogic</a></span><span class="op">(</span><span class="va">sp4</span>, byhz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;                id top bottom valid hzID depthLogic sameDepth missingDepth overlapOrGap</span></span>
<span><span class="co">#&gt; 1          colusa   0      3  TRUE    1      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 2          colusa   3      8  TRUE    2      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 3          colusa   8     30  TRUE    3      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 4          colusa  30     42  TRUE    4      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 5           glenn   0      9  TRUE    5      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 6           glenn   9     34  TRUE    6      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 7           kings   0      4  TRUE    7      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 8           kings   4     13  TRUE    8      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 9           kings  13     40  TRUE    9      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 10       mariposa   0      3  TRUE   10      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 11       mariposa   3     14  TRUE   11      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 12       mariposa  14     34  TRUE   12      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 13       mariposa  34     49  TRUE   13      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 14      mendocino   0      2  TRUE   14      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 15      mendocino   2      8  TRUE   15      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 16      mendocino   8     30  TRUE   16      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 17           napa   0      6  TRUE   17      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 18           napa   6     20  TRUE   18      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 19     san benito   0      8  TRUE   19      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 20     san benito   8     20  TRUE   20      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 21         shasta   0      3  TRUE   21      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 22         shasta   3     40  TRUE   22      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 23 shasta-trinity   0      2  TRUE   23      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 24 shasta-trinity   2      5  TRUE   24      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 25 shasta-trinity   5     12  TRUE   25      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 26 shasta-trinity  12     23  TRUE   26      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 27 shasta-trinity  23     40  TRUE   27      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 28         tehama   0      3  TRUE   28      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 29         tehama   3      7  TRUE   29      FALSE     FALSE        FALSE        FALSE</span></span>
<span><span class="co">#&gt; 30         tehama   7     16  TRUE   30      FALSE     FALSE        FALSE        FALSE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="coercion">Coercion<a class="anchor" aria-label="anchor" href="#coercion"></a>
</h2>
<p>SoilProfileCollection objects can be coerced to <code>data.frame</code>, <code>list</code> and <code>SpatialPointsDataFrame</code> (when spatial slot has been set up):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check our work by viewing the internal structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a data.frame from horizon+site data</span></span>
<span><span class="fu"><a href="../reference/coercion-methods.html">as</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="st">'data.frame'</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># or, equivalently:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert SoilProfileCollection to a named list containing all slots</span></span>
<span><span class="fu"><a href="../reference/coercion-methods.html">as</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="st">'list'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extraction of site + spatial data as SpatialPointsDataFrame</span></span>
<span><span class="fu"><a href="../reference/coercion-methods.html">as</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="st">'SpatialPointsDataFrame'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="subsetting-soilprofilecollection-objects">Subsetting SoilProfileCollection Objects<a class="anchor" aria-label="anchor" href="#subsetting-soilprofilecollection-objects"></a>
</h2>
<p><code>SoilProfileCollection</code> objects can be subset using the familiar <code>[</code>-style notation used by matrix and <code>data.frame</code> objects, such that: <code>spc[i, j]</code> will return profiles identified by the integer vector <code>i</code>, and horizons identified by the integer vector <code>j</code>.</p>
<p>Omitting either index will result in all profiles (<code>i</code> omitted) or all horizons (<code>j</code> omitted).</p>
<p>Typically, site-level attributes will be used as the subsetting criteria. Functions that return an index to matches (such as <code><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep()</a></code> or <code><a href="https://rdrr.io/r/base/which.html" class="external-link">which()</a></code>) provide the link between attributes and an index to matching profiles.</p>
<div class="section level3">
<h3 id="profiles">Profiles<a class="anchor" aria-label="anchor" href="#profiles"></a>
</h3>
<p>Using the <em>i</em> index, select one or more profiles by numeric index. An index greater than the number of profiles will return an empty <code>SoilProfileCollection</code> object.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># explicit string matching</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">$</span><span class="va">group</span> <span class="op">==</span> <span class="st">'A'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># numerical expressions</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">$</span><span class="va">elevation</span> <span class="op">&lt;</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># regular expression, matches any profile ID containing 'shasta'</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'shasta'</span>, <span class="fu"><a href="../reference/profile_id.html">profile_id</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># perform subset based on index</span></span>
<span><span class="va">sp4</span><span class="op">[</span><span class="va">idx</span>, <span class="op">]</span></span></code></pre></div>
<p>In an interactive session, it is often simpler to use <code><a href="../reference/subset-SoilProfileCollection-method.html">subset()</a></code> directly:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/subset-SoilProfileCollection-method.html">subset</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="va">group</span> <span class="op">==</span> <span class="st">'A'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/subset-SoilProfileCollection-method.html">subset</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="va">elevation</span> <span class="op">&lt;</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/subset-SoilProfileCollection-method.html">subset</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'shasta'</span>, <span class="va">id</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="horizons-by-index">Horizons by Index<a class="anchor" aria-label="anchor" href="#horizons-by-index"></a>
</h3>
<p>Using the <em>j</em> index, select the 2nd horizon from each profile in the collection. Use with caution, asking for a horizon beyond the length of any profile in the collection will result in an error.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp4</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="horizons-by-keyword">Horizons by Keyword<a class="anchor" aria-label="anchor" href="#horizons-by-keyword"></a>
</h3>
<p>Using the <em>k</em> index, select the <code>.FIRST</code> first or <code>.LAST</code> horizons (by profile) within a collection. Note that <code>.FIRST</code> and <code>.LAST</code> are special keywords used by the <code>SoilProfileCollection</code> subset methods.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp4</span><span class="op">[</span>, , <span class="va">.FIRST</span><span class="op">]</span></span>
<span><span class="va">sp4</span><span class="op">[</span>, , <span class="va">.LAST</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="splitting-duplication-and-selection-of-unique-profiles">Splitting, Duplication, and Selection of Unique Profiles<a class="anchor" aria-label="anchor" href="#splitting-duplication-and-selection-of-unique-profiles"></a>
</h2>
<p><code>SoilProfileCollection</code> objects are combined by passing a list of objects to the <code><a href="../reference/combine-SoilProfileCollection-method.html">combine()</a></code> function.</p>
<p>Ideally all objects share the same internal structure, profile ID, horizon ID, depth units, and other parameters of a <code>SoilProfileCollection</code>. Manually subset the example data into 3 pieces, compile into a list, and then <code>combine</code> back together.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset data into chunks</span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="va">sp4</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="va">sp4</span><span class="op">[</span><span class="fl">4</span>, <span class="op">]</span></span>
<span><span class="va">s3</span> <span class="op">&lt;-</span> <span class="va">sp4</span><span class="op">[</span><span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># combine subsets</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">combine</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">s2</span>, <span class="va">s3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># double-check result</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p>It is possible to combine <code>SoilProfileCollection</code> objects with different internal structure. The final object will contain the all site and horizon columns from the inputs, possibly creating sparse tables. IDs and horizon depth names are taken from the first object.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sample data as data.frame objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># rename IDs horizon top / bottom columns</span></span>
<span><span class="va">sp3</span><span class="op">$</span><span class="va">newid</span> <span class="op">&lt;-</span> <span class="va">sp3</span><span class="op">$</span><span class="va">id</span></span>
<span><span class="va">sp3</span><span class="op">$</span><span class="va">hztop</span> <span class="op">&lt;-</span> <span class="va">sp3</span><span class="op">$</span><span class="va">top</span></span>
<span><span class="va">sp3</span><span class="op">$</span><span class="va">hzbottom</span> <span class="op">&lt;-</span> <span class="va">sp3</span><span class="op">$</span><span class="va">bottom</span></span>
<span></span>
<span><span class="co"># remove originals</span></span>
<span><span class="va">sp3</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">sp3</span><span class="op">$</span><span class="va">top</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">sp3</span><span class="op">$</span><span class="va">bottom</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># promote to SoilProfileCollection</span></span>
<span><span class="fu">depths</span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span>
<span><span class="fu">depths</span><span class="op">(</span><span class="va">sp3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">newid</span> <span class="op">~</span> <span class="va">hztop</span> <span class="op">+</span> <span class="va">hzbottom</span></span>
<span></span>
<span><span class="co"># label each group via site-level attribute</span></span>
<span><span class="fu"><a href="../reference/site.html">site</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span><span class="op">$</span><span class="va">g</span> <span class="op">&lt;-</span> <span class="st">'sp1'</span></span>
<span><span class="fu"><a href="../reference/site.html">site</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">)</span><span class="op">$</span><span class="va">g</span> <span class="op">&lt;-</span> <span class="st">'sp3'</span></span>
<span></span>
<span><span class="co"># combine</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">combine</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sp1</span>, <span class="va">sp3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make grouping variable into a factor for groupedProfilePlot</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">g</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># graphical check</span></span>
<span><span class="co"># convert character horizon IDs into numeric</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">.horizon_ids_numeric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="../reference/hzID.html">hzID</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">x</span>, color<span class="op">=</span><span class="st">'.horizon_ids_numeric'</span>, col.label <span class="op">=</span> <span class="st">'Horizon ID'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/groupedProfilePlot.html">groupedProfilePlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'g'</span>, color<span class="op">=</span><span class="st">'.horizon_ids_numeric'</span>, col.label <span class="op">=</span> <span class="st">'Horizon ID'</span>, group.name.offset <span class="op">=</span> <span class="op">-</span><span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="splitting">Splitting<a class="anchor" aria-label="anchor" href="#splitting"></a>
</h3>
<p>The inverse of <code><a href="../reference/combine-SoilProfileCollection-method.html">combine()</a></code> is <code><a href="https://rdrr.io/r/base/split.html" class="external-link">split()</a></code>: subsets of the <code>SoilProfileCollection</code> are split into list elements, each containing a new <code>SoilProfileCollection</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># continuing from above</span></span>
<span><span class="co"># split subsets of x into a list of SoilProfileCollection objects using site-level attribute 'g'</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'g'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="duplication">Duplication<a class="anchor" aria-label="anchor" href="#duplication"></a>
</h3>
<p>Duplicate the first profile in <code>sp4</code> (Colusa) 8 times, resulting in a new <code>SoilProfileCollection</code> object containing unique profile IDs.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/duplicate.html">duplicate</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, times <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">d</span>, color <span class="op">=</span> <span class="st">'ex_Ca_to_Mg'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="selecting-unique-profiles">Selecting Unique Profiles<a class="anchor" aria-label="anchor" href="#selecting-unique-profiles"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># an example soil profile  </span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">'A'</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'E'</span>, <span class="st">'Bhs'</span>, <span class="st">'Bt1'</span>, <span class="st">'Bt2'</span>, <span class="st">'BC'</span>, <span class="st">'C'</span><span class="op">)</span>,</span>
<span>  top <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  bottom <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">125</span><span class="op">)</span>,</span>
<span>  z <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">10</span>, <span class="fl">2</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># init SPC</span></span>
<span><span class="fu">depths</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span>
<span><span class="fu"><a href="../reference/hzdesgnname.html">hzdesgnname</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'name'</span></span>
<span></span>
<span><span class="co"># horizon depth variability for simulation</span></span>
<span><span class="fu"><a href="../reference/horizons.html">horizons</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">.sd</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># duplicate several times</span></span>
<span><span class="va">x.dupes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/duplicate.html">duplicate</a></span><span class="op">(</span><span class="va">x</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate some new profiles based on example</span></span>
<span><span class="co"># 2cm constant standard deviation of transition between horizons assumed</span></span>
<span><span class="va">x.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perturb.html">perturb</a></span><span class="op">(</span><span class="va">x</span>, n <span class="op">=</span> <span class="fl">5</span>, thickness.attr <span class="op">=</span> <span class="st">'.sd'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># graphical check</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># inspect unique results</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="fu"><a href="../reference/unique.html">unique</a></span><span class="op">(</span><span class="va">x.dupes</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'top'</span>, <span class="st">'bottom'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        name.style <span class="op">=</span> <span class="st">'center-center'</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># "uniqueness" is a function of variables selected to consider</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="fu"><a href="../reference/unique.html">unique</a></span><span class="op">(</span><span class="va">x.sim</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'top'</span>, <span class="st">'bottom'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        name.style <span class="op">=</span> <span class="st">'center-center'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="fu"><a href="../reference/unique.html">unique</a></span><span class="op">(</span><span class="va">x.sim</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'name'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        name.style <span class="op">=</span> <span class="st">'center-center'</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-14-2.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="plotting-soilprofilecollection-objects">Plotting SoilProfileCollection Objects<a class="anchor" aria-label="anchor" href="#plotting-soilprofilecollection-objects"></a>
</h2>
<p>The <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code> method for <code>SoilProfileCollection</code> objects generates sketches of profiles within the collection based on horizon boundaries, vertically aligned to an integer sequence from 1 to the number of profiles.</p>
<p>Horizon names are automatically extracted from a horizon-level attribute <code>name</code> (if present), or via an alternate attributed given as an argument: <code>name='column.name'</code>.</p>
<p>Horizon colors are automatically generated from the horizon-level attribute <code>soil_color</code>, or any other attribute of <strong>R</strong>-compatible color description given as an argument: <code>color='column.name'</code>. This function is highly customizable, therefore, it is prudent to consult <code><a href="../reference/SoilProfileCollection-plotting-methods.html">help(plotSPC)</a></code> from time to time. Soil colors in Munsell notation can be converted to <strong>R</strong>-compatible colors via <code><a href="../reference/munsell2rgb.html">munsell2rgb()</a></code>.</p>
<p>Many of the following examples make use of <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par()</a></code> to set graphical options such as <code>mar</code> (customized margins) and/or <code>xpd = NA</code> (turn off clipping) to optimize display of different numbers of profiles and various <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code> arguments.</p>
<div class="section level3">
<h3 id="making-adjustments">Making Adjustments<a class="anchor" aria-label="anchor" href="#making-adjustments"></a>
</h3>
<p>The <code><a href="../reference/explainPlotSPC.html">explainPlotSPC()</a></code> function is helpful for adjusting some of the more obscure arguments to <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code>.</p>
<p>A basic plot with debugging information overlaid:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-15-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Make sketches wider:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-16-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Move soil surface at 0cm “down” 5cm:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, y.offset <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-17-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Move soil surface at 0cm “up” 10cm; useful for sketches of shallow profiles:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, y.offset <span class="op">=</span> <span class="op">-</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-18-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Scale depths by 50%:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, scaling.factor <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-19-1.png" width="864" style="display: block; margin: auto;"></p>
<p>A graphical explanation of how profiles are re-arranged via <code>plot.order</code> argument:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, plot.order <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-20-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Leave room for an additional 2 profile sketches:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, n <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-21-1.png" width="864" style="display: block; margin: auto;"></p>
<div class="section level4">
<h4 id="small-soilprofilecollections">Small SoilProfileCollections<a class="anchor" aria-label="anchor" href="#small-soilprofilecollections"></a>
</h4>
<p>Making quality figures with fewer than 5 soil profiles usually requires more customization of the basic call to <code>plotSPC</code>. In general, the following are a good starting point:</p>
<ul>
<li>shrink margins and disable clipping with <code>par</code>
</li>
<li>adjust output graphic device (e.g. <code><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png()</a></code>) dimensions and resolution</li>
<li>increase font size with <code>cex.names</code>
</li>
<li>adjust sketch width with <code>width</code>, typically within 0.15-0.35</li>
<li>move depth axis to the left with negative <code>axis.line.offset</code> values</li>
</ul>
<p>Get some example data from the Official Series Descriptions:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ncss-tech.github.io/soilDB/" class="external-link">soilDB</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ncss-tech.github.io/soilDB/reference/fetchOSD.html" class="external-link">fetchOSD</a></span><span class="op">(</span><span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'appling'</span>, <span class="st">'cecil'</span>, <span class="st">'bonneau'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Using 5x6 inch output device:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, xpd <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, cex.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-23-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Using 7x6 inch output device, slight adjustments to <code>width</code> usually required:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set margins and turn off clipping</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, xpd <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, cex.names <span class="op">=</span> <span class="fl">1</span>, width <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Using 8x6 inch output device, slight adjustments to <code>axis.line.offset</code> and <code>width</code> are usually required:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, xpd <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">x</span>, cex.names <span class="op">=</span> <span class="fl">1</span>, axis.line.offset <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-25-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="horizon-depth-labeling">Horizon Depth Labeling<a class="anchor" aria-label="anchor" href="#horizon-depth-labeling"></a>
</h3>
<p>Horizon depths can be labeled for each profile as an alternative to a single depth axis.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  cex.names <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  name.style <span class="op">=</span> <span class="st">'center-center'</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  plot.depth.axis <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  hz.depths <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fixLabelCollisions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  hz.depths.offset <span class="op">=</span> <span class="fl">0.08</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-26-1.png" width="768" style="display: block; margin: auto;"></p>
<p>As of aqp version 1.41, it is possible to “fix” overlapping horizon depth labels with the new <code>fixLabelCollisions</code> argument. This approach to labeling depths works best when moving horizon designations with the <code>name.style</code> argument. Note that setting <code>fixLabelCollisions = TRUE</code> may incur a significant performance penalty when plotting large <code>SoilProfileCollection</code> objects.</p>
</div>
<div class="section level3">
<h3 id="relative-horizontal-positioning">Relative Horizontal Positioning<a class="anchor" aria-label="anchor" href="#relative-horizontal-positioning"></a>
</h3>
<p>Relative horizontal positioning via <code>relative.pos</code> argument. Can be used with <code>plot.order</code> but be careful: <code>relative.pos</code> must be specified in the <em>final</em> ordering of profiles. See <code><a href="../reference/SoilProfileCollection-plotting-methods.html">?plotSPC</a></code> for details.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, relative.pos <span class="op">=</span> <span class="va">pos</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-27-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Relative positioning works well when the vector of positions is close to the default spacing along an integer sequence, but not when positions are closer than the width of a profile sketch.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5.2</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, relative.pos <span class="op">=</span> <span class="va">pos</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-28-1.png" width="864" style="display: block; margin: auto;"></p>
<p>The <code><a href="../reference/fixOverlap.html">fixOverlap()</a></code> function can be used to find a suitable arrangement of profiles based on a compromise between the suggested relative positions and minimization of overlap.</p>
<p>This is an iterative procedure, based on random perturbations of overlapping profiles, therefore it is possible for the algorithm to stop at a sub-optimal configuration. Results can be controlled using <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new.pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, relative.pos <span class="op">=</span> <span class="va">new.pos</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-29-1.png" width="864" style="display: block; margin: auto;"></p>
<p>There are several parameters available for optimizing horizontal position in the presence of overlap. See <code><a href="../reference/fixOverlap.html">?fixOverlap</a></code> for details and further examples.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new.pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">pos</span>, thresh <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/explainPlotSPC.html">explainPlotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span>, relative.pos <span class="op">=</span> <span class="va">new.pos</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-30-1.png" width="864" style="display: block; margin: auto;"> The <a href="http://ncss-tech.github.io/AQP/aqp/SPC-plotting-ideas.html" class="external-link">SPC plotting ideas tutorial</a> contains several additional examples.</p>
</div>
<div class="section level3">
<h3 id="thematic-sketches">Thematic Sketches<a class="anchor" aria-label="anchor" href="#thematic-sketches"></a>
</h3>
<p>Horizon-level attributes can be symbolized with color, in this case using the horizon-level attribute “clay”:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">sp4</span>,</span>
<span>        name <span class="op">=</span> <span class="st">'name'</span>,</span>
<span>        color <span class="op">=</span> <span class="st">'clay'</span>,</span>
<span>        col.label <span class="op">=</span> <span class="st">'Clay Content (%)'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-31-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Use a different set of colors:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span></span>
<span>  <span class="va">sp4</span>,</span>
<span>  name <span class="op">=</span> <span class="st">'name'</span>,</span>
<span>  color <span class="op">=</span> <span class="st">'clay'</span>,</span>
<span>  col.palette <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">'Spectral'</span><span class="op">)</span>,</span>
<span>  col.label <span class="op">=</span> <span class="st">'Clay Content (%)'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-32-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Categorical properties can also be used to make a thematic sketch. Colors are interpolated when there are more classes than colors provided by <code>col.palette</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span></span>
<span>  <span class="va">sp4</span>,</span>
<span>  name <span class="op">=</span> <span class="st">'name'</span>,</span>
<span>  color <span class="op">=</span> <span class="st">'name'</span>,</span>
<span>  col.palette <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">'Set1'</span><span class="op">)</span>,</span>
<span>  col.label <span class="op">=</span> <span class="st">'Original Horizon Name'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-33-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Try with <a href="http://ncss-tech.github.io/AQP/aqp/gen-hz-assignment.html" class="external-link">generalized horizon labels</a>:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># generalize horizon names into 3 groups</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">genhz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generalize.hz.html">generalize.hz</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">$</span><span class="va">name</span>, new <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'AB'</span>, <span class="st">'Bt'</span><span class="op">)</span>, pat <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'A[0-9]?'</span>, <span class="st">'AB'</span>, <span class="st">'^Bt'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span></span>
<span>  <span class="va">sp4</span>,</span>
<span>  name <span class="op">=</span> <span class="st">'name'</span>,</span>
<span>  color <span class="op">=</span> <span class="st">'genhz'</span>,</span>
<span>  col.palette <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">3</span>, <span class="st">'Spectral'</span><span class="op">)</span>,</span>
<span>  col.label <span class="op">=</span> <span class="st">'Generalized Horizon Name'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-34-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Horizon-level attributes that represent a volume fraction (e.g. coarse-fragment percentage) can be added to an existing figure. See <code><a href="../reference/addVolumeFraction.html">?addVolumeFraction</a></code> for adding layers to an existing plot based on these attributes.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># convert coarse rock fragment proportion to percentage</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">frag_pct</span> <span class="op">&lt;-</span> <span class="va">sp4</span><span class="op">$</span><span class="va">CF</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># label horizons with fragment percent</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'frag_pct'</span>, color <span class="op">=</span> <span class="st">'frag_pct'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># symbolize volume fraction data</span></span>
<span><span class="fu"><a href="../reference/addVolumeFraction.html">addVolumeFraction</a></span><span class="op">(</span><span class="va">sp4</span>, colname <span class="op">=</span> <span class="st">'frag_pct'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/plotting-vol-fraction-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="depth-intervals">Depth Intervals<a class="anchor" aria-label="anchor" href="#depth-intervals"></a>
</h3>
<p>Annotation of depth-intervals can be accomplished using “brackets”. Here we extract top/bottom depths associated with top and bottom depth A horizons using the min/max variants of the <code><a href="../reference/depthOf.html">depthOf()</a></code> function. See ?depthOf for more details.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract top/bottom depths associated with all A horizons</span></span>
<span><span class="va">tops</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depthOf.html">minDepthOf</a></span><span class="op">(</span><span class="va">sp4</span>, pattern <span class="op">=</span> <span class="st">'^A'</span>, hzdesgn <span class="op">=</span> <span class="st">'name'</span>, top <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">bottoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depthOf.html">maxDepthOf</a></span><span class="op">(</span><span class="va">sp4</span>, pattern <span class="op">=</span> <span class="st">'^A'</span>, hzdesgn <span class="op">=</span> <span class="st">'name'</span>, top <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">IDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profile_id.html">profile_id</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assemble data.frame</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">IDs</span>, top <span class="op">=</span> <span class="va">tops</span><span class="op">$</span><span class="va">top</span>, bottom <span class="op">=</span> <span class="va">bottoms</span><span class="op">$</span><span class="va">bottom</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check</span></span>
<span><span class="va">a</span></span>
<span><span class="co">#&gt;                id top bottom</span></span>
<span><span class="co">#&gt; 1          colusa   0      8</span></span>
<span><span class="co">#&gt; 2           glenn   0      9</span></span>
<span><span class="co">#&gt; 3           kings   0      4</span></span>
<span><span class="co">#&gt; 4        mariposa   0      3</span></span>
<span><span class="co">#&gt; 5       mendocino   0      2</span></span>
<span><span class="co">#&gt; 6            napa   0      6</span></span>
<span><span class="co">#&gt; 7      san benito   0      8</span></span>
<span><span class="co">#&gt; 8          shasta   0      3</span></span>
<span><span class="co">#&gt; 9  shasta-trinity   0     12</span></span>
<span><span class="co">#&gt; 10         tehama   0      3</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># annotate A horizon depth interval with brackets</span></span>
<span><span class="fu"><a href="../reference/addBracket.html">addBracket</a></span><span class="op">(</span><span class="va">a</span>, col <span class="op">=</span> <span class="st">'red'</span>, offset <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-35-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Add labels:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, name <span class="op">=</span> <span class="st">'name'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># addBracket() looks for a column `label`; add a ID for each bracket</span></span>
<span><span class="va">a</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/site.html">site</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">$</span><span class="va">id</span></span>
<span></span>
<span><span class="co"># note that depth brackets "knows which profiles to use" via profile ID</span></span>
<span><span class="fu"><a href="../reference/addBracket.html">addBracket</a></span><span class="op">(</span></span>
<span>  <span class="va">a</span>,</span>
<span>  col <span class="op">=</span> <span class="st">'red'</span>,</span>
<span>  label.cex <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  missing.bottom.depth <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  offset <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-36-1.png" width="768" style="display: block; margin: auto;"></p>
<p>It is possible to arrange profile sketches by site-level grouping variable:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="../reference/groupedProfilePlot.html">groupedProfilePlot</a></span><span class="op">(</span><span class="va">sp4</span>, groups <span class="op">=</span> <span class="st">'group'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/addBracket.html">addBracket</a></span><span class="op">(</span><span class="va">a</span>, col <span class="op">=</span> <span class="st">'red'</span>, offset <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-37-1.png" width="768" style="display: block; margin: auto;"></p>
<p>There need not be brackets for all profiles in a collection:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">a.sub</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="../reference/groupedProfilePlot.html">groupedProfilePlot</a></span><span class="op">(</span><span class="va">sp4</span>, groups <span class="op">=</span> <span class="st">'group'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/addBracket.html">addBracket</a></span><span class="op">(</span><span class="va">a.sub</span>, col <span class="op">=</span> <span class="st">'red'</span>, offset <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-38-1.png" width="768" style="display: block; margin: auto;"></p>
<p>When bottom depths are missing an arrow is used:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span><span class="op">$</span><span class="va">bottom</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/groupedProfilePlot.html">groupedProfilePlot</a></span><span class="op">(</span><span class="va">sp4</span>, groups <span class="op">=</span> <span class="st">'group'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/addBracket.html">addBracket</a></span><span class="op">(</span><span class="va">a</span>, col <span class="op">=</span> <span class="st">'red'</span>, offset <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-39-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Manually define bottom depth:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/groupedProfilePlot.html">groupedProfilePlot</a></span><span class="op">(</span><span class="va">sp4</span>, groups <span class="op">=</span> <span class="st">'group'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/addBracket.html">addBracket</a></span><span class="op">(</span></span>
<span>  <span class="va">a</span>,</span>
<span>  col <span class="op">=</span> <span class="st">'red'</span>,</span>
<span>  label.cex <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  missing.bottom.depth <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  offset <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-40-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Further customization of brackets:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">sp4</span>, max.depth <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># copy root-restricting features</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/restrictions.html">restrictions</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add a label: restrictive feature 'kind'</span></span>
<span><span class="va">a</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="va">kind</span></span>
<span></span>
<span><span class="co"># add restrictions using vertical bars</span></span>
<span><span class="fu"><a href="../reference/addBracket.html">addBracket</a></span><span class="op">(</span></span>
<span>  <span class="va">a</span>,</span>
<span>  col <span class="op">=</span> <span class="st">'red'</span>,</span>
<span>  label.cex <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  tick.length <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  offset <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-41-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="section level4">
<h4 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h4>
<p>These functions (<code><a href="../reference/addBracket.html">addBracket()</a></code>, <code><a href="../reference/addDiagnosticBracket.html">addDiagnosticBracket()</a></code>, and <code><a href="../reference/addVolumeFraction.html">addVolumeFraction()</a></code>) will automatically compensate for alternative sketch ordering or relative positioning of profiles.</p>
</div>
</div>
<div class="section level3">
<h3 id="svg-output-for-use-in-page-layout-tools">SVG Output for Use in Page Layout Tools<a class="anchor" aria-label="anchor" href="#svg-output-for-use-in-page-layout-tools"></a>
</h3>
<p>Sketches for use in layout tools such as Adobe Illustrator or Inkscape should be stored in a vector file format. SVG is compatible with most software titles. WMF output is compatible with MS Office tools and can be written with the <code>win.metafile()</code> function.</p>
<!-- including this example (uncommented) will require svglite added to Suggests -->
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(svglite)</span></span>
<span><span class="co"># svglite(filename = 'e:/temp/fig.svg', width = 7, height = 6, pointsize = 12)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># par(mar = c(0,2,0,4), xpd = NA)</span></span>
<span><span class="co"># plotSPC(x, cex.names=1, axis.line.offset = -0.2, width=0.3)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># dev.off()</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="iterating-over-profiles-in-a-collection">Iterating Over Profiles in a Collection<a class="anchor" aria-label="anchor" href="#iterating-over-profiles-in-a-collection"></a>
</h2>
<p>The <code><a href="../reference/profileApply.html">profileApply()</a></code> function is an extension of the familiar <em>apply()</em> family of functions that operate on vectors (<code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply()</a></code> and <code><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply()</a></code>), matrices (<code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code>), and lists (<code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>)– extended to <code>SoilProfileCollection</code> objects.</p>
<p>The function named in the <code>FUN</code> argument is evaluated once for each profile in the collection, typically returning a single value per profile. In this case, the ordering of the results would match the ordering of values in the site level attribute table.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># max() returns the depth of a soil profile</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">soil.depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">sp4</span>, FUN <span class="op">=</span> <span class="va">max</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># max() with additional argument give max depth to non-missing 'clay'</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">soil.depth.clay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">sp4</span>, FUN <span class="op">=</span> <span class="va">max</span>, v <span class="op">=</span> <span class="st">'clay'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># nrow() returns the number of horizons</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">n.hz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">sp4</span>, FUN <span class="op">=</span> <span class="va">nrow</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compute the mean clay content by profile using an inline function</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">mean.clay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">sp4</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">i</span><span class="op">$</span><span class="va">clay</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate soil depth based on horizon designation</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">soil.depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="va">estimateSoilDepth</span>, name <span class="op">=</span> <span class="st">'name'</span><span class="op">)</span></span></code></pre></div>
<p>When <code>FUN</code> returns a vector of the same length as the number of horizons in a profile, <code><a href="../reference/profileApply.html">profileApply()</a></code> can be used to create new horizon-level attributes. For example, the change in clay content by horizon depth (<code>delta.clay</code>, below) could be calculated as:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save as horizon-level attribute</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">delta.clay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">sp4</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">i</span><span class="op">$</span><span class="va">clay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check results:</span></span>
<span><span class="fu"><a href="../reference/horizons.html">horizons</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'id'</span>, <span class="st">'top'</span>, <span class="st">'bottom'</span>, <span class="st">'clay'</span>, <span class="st">'delta.clay'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;       id top bottom clay delta.clay</span></span>
<span><span class="co">#&gt; 1 colusa   0      3   21         NA</span></span>
<span><span class="co">#&gt; 2 colusa   3      8   27          6</span></span>
<span><span class="co">#&gt; 3 colusa   8     30   32          5</span></span>
<span><span class="co">#&gt; 4 colusa  30     42   55         23</span></span>
<span><span class="co">#&gt; 5  glenn   0      9   25         NA</span></span>
<span><span class="co">#&gt; 6  glenn   9     34   34          9</span></span></code></pre></div>
<p>More complex summaries can be generated by writing a custom function that is then called by <code><a href="../reference/profileApply.html">profileApply()</a></code>. Note that each profile is passed into this function and accessed via a temporary variable (<code>i</code>), which is a <code>SoilProfileCollection</code> object containing a single profile. See <code><a href="../reference/profileApply.html">help(profileApply)</a></code> for details.</p>
<p>A list of <code>SoilProfileCollection</code> objects returned from a custom function can be combined into a single <code>SoilProfileCollection</code> object via <code><a href="../reference/combine-SoilProfileCollection-method.html">combine()</a></code>.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute hz-thickness weighted mean exchangeable-Ca:Mg</span></span>
<span><span class="va">wt.mean.ca.mg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># use horizon thickness as a weight</span></span>
<span>  <span class="va">thick</span> <span class="op">&lt;-</span> <span class="va">i</span><span class="op">$</span><span class="va">bottom</span> <span class="op">-</span> <span class="va">i</span><span class="op">$</span><span class="va">top</span></span>
<span>  </span>
<span>  <span class="co"># compute the thickness weighted mean, ignoring missing values</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">i</span><span class="op">$</span><span class="va">ex_Ca_to_Mg</span>, w <span class="op">=</span> <span class="va">thick</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># apply our custom function and save results as a site-level attribute</span></span>
<span><span class="va">sp4</span><span class="op">$</span><span class="va">wt.mean.ca.to.mg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="va">wt.mean.ca.mg</span><span class="op">)</span></span></code></pre></div>
<p>We can now use our some of our new site-level attributes to order the profiles when plotting.</p>
<p>In this case profiles are ordered based on the horizon-thickness weighted mean, exchangeable Ca:Mg values. Horizons are colored by exchangeable Ca:Mg values.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the data using our new order based on Ca:Mg weighted average</span></span>
<span><span class="co"># the result is an index of rank </span></span>
<span><span class="va">new.order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">$</span><span class="va">wt.mean.ca.to.mg</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co"># tighten figure margins</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">sp4</span>,</span>
<span>        name <span class="op">=</span> <span class="st">'name'</span>,</span>
<span>        color <span class="op">=</span> <span class="st">'ex_Ca_to_Mg'</span>,</span>
<span>        plot.order <span class="op">=</span> <span class="va">new.order</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add an axis labeled with the sorting criteria</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">$</span><span class="va">wt.mean.ca.to.mg</span>, <span class="fl">3</span><span class="op">)</span>, cex.axis <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.25</span>, text <span class="op">=</span> <span class="st">'Horizon Thickness Weighted Mean Ex. Ca:Mg'</span>, cex <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/profileApply-4-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="slicing-horizons-dice">Slicing Horizons: <code>dice()</code><a class="anchor" aria-label="anchor" href="#slicing-horizons-dice"></a>
</h2>
<p>Collections of soil profiles can be sliced (or re-sampled) into regular depth-intervals with the <code><a href="../reference/dice-SoilProfileCollection-method.html">dice()</a></code> function. The slicing structure and variables of interest are defined via formula notation:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># slice select horizon-level attributes</span></span>
<span><span class="va">seq</span> <span class="op">~</span> <span class="va">var.1</span> <span class="op">+</span> <span class="va">var.2</span> <span class="op">+</span> <span class="va">var.3</span> <span class="op">+</span> <span class="va">...</span></span>
<span><span class="co"># slice all horizon-level attributes</span></span>
<span><span class="va">seq</span> <span class="op">~</span> <span class="va">.</span></span></code></pre></div>
<p>where <code>seq</code> is a sequence of integers (e.g. <code>0:15</code>, <code>c(5,10,15,20)</code>, etc.) and <code>var.1 + var.2 + var.3 + ...</code> are horizon-level attributes to slice. Both continuous and categorical variables can be named on the right-hand-side of the formula. The results returned by <code><a href="../reference/dice-SoilProfileCollection-method.html">dice()</a></code> is either a <code>SoilProfileCollection</code>, or <code>data.frame</code> when called with the optional argument <code>SPC = FALSE</code>. For example, to slice our sample data set into 1-cm intervals, from 0–15 cm:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># resample to 1cm slices</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dice-SoilProfileCollection-method.html">dice</a></span><span class="op">(</span><span class="va">sp4</span>, fm <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">15</span> <span class="op">~</span> <span class="va">sand</span> <span class="op">+</span> <span class="va">silt</span> <span class="op">+</span> <span class="va">clay</span> <span class="op">+</span> <span class="va">name</span> <span class="op">+</span> <span class="va">ex_Ca_to_Mg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check the result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "SoilProfileCollection"</span></span>
<span><span class="co">#&gt; attr(,"package")</span></span>
<span><span class="co">#&gt; [1] "aqp"</span></span>
<span></span>
<span><span class="co"># plot sliced data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co"># tighten figure margins</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">s</span>, color <span class="op">=</span> <span class="st">'ex_Ca_to_Mg'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-43-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Once soil profile data have been sliced, it is simple to extract “chunks” of data by depth interval via <code>[</code>-subsetting:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># slice from 0 to max depth in the collection</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dice-SoilProfileCollection-method.html">dice</a></span><span class="op">(</span><span class="va">sp4</span>, fm<span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fu"><a href="../reference/max.html">max</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">~</span> <span class="va">sand</span> <span class="op">+</span> <span class="va">silt</span> <span class="op">+</span> <span class="va">clay</span> <span class="op">+</span> <span class="va">name</span> <span class="op">+</span> <span class="va">ex_Ca_to_Mg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract all data over the range of 5--10 cm:</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract all data over the range of 25--50 cm:</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span>, <span class="fl">25</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract all data over the range of 10--20 and 40--50 cm:</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span>, <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">40</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="ragged-extraction-glom">Ragged Extraction: <code>glom()</code><a class="anchor" aria-label="anchor" href="#ragged-extraction-glom"></a>
</h2>
<p>Select all horizons that overlap the interval of 5-15cm:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># truncate to the interval 5-15cm</span></span>
<span><span class="va">clods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/glom-SoilProfileCollection-method.html">glom</a></span><span class="op">(</span><span class="va">sp4</span>, z1 <span class="op">=</span> <span class="fl">5</span>, z2 <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">clods</span>, name <span class="op">=</span> <span class="st">'name'</span>, color <span class="op">=</span> <span class="st">'ex_Ca_to_Mg'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rect.html" class="external-link">rect</a></span><span class="op">(</span>xleft <span class="op">=</span> <span class="fl">0.5</span>, ybottom <span class="op">=</span> <span class="fl">15</span>, xright <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>, ytop <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-45-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="truncation-trunc">Truncation: <code>trunc()</code><a class="anchor" aria-label="anchor" href="#truncation-trunc"></a>
</h2>
<p>Truncate the SPC to the interval of 5-15cm:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># truncate to the interval 5-15cm</span></span>
<span><span class="va">sp4.truncated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trunc-SoilProfileCollection-method.html">trunc</a></span><span class="op">(</span><span class="va">sp4</span>, <span class="fl">5</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">sp4.truncated</span>, name <span class="op">=</span> <span class="st">'name'</span>, color <span class="op">=</span> <span class="st">'ex_Ca_to_Mg'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rect.html" class="external-link">rect</a></span><span class="op">(</span>xleft <span class="op">=</span> <span class="fl">0.5</span>, ybottom <span class="op">=</span> <span class="fl">15</span>, xright <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>, ytop <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-46-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="depth-aggregation-slab">Depth Aggregation: <code>slab()</code><a class="anchor" aria-label="anchor" href="#depth-aggregation-slab"></a>
</h2>
<p>Depth-wise summary of horizon-level attributes is performed with the <code><a href="../reference/slab-methods.html">slab()</a></code> function. Profile grouping criteria and horizon attribute selection is parametrized via formula: either <code>groups ~ var1 + var2 + var3</code> where named variables are aggregated within <code>groups</code> OR where named variables are aggregated across the entire collection <code>~ var1 + var2 + var3</code>. The default summary function (<code>slab.fun</code>) computes the 5th, 25th, 50th, 75th, and 95th percentiles via Harrell-Davis quantile estimator.</p>
<p>The depth structure (“slabs”) over which summaries are computed is defined with the <code>slab.structure</code> argument using:</p>
<ul>
<li>a single integer (e.g. <code>10</code>): data are aggregated over a regular sequence of 10-unit thickness slabs</li>
<li>a vector of 2 integers (e.g. <code>c(50, 60)</code>): data are aggregated over depths spanning 50–60 units</li>
<li>a vector of 3 or more integers (e.g. <code>c(0, 5, 10, 50, 100)</code>): data are aggregated over the depths spanning 0–5, 5–10, 10–50, 50–100 units</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aggregate a couple of the horizon-level attributes, </span></span>
<span><span class="co"># across the entire collection, </span></span>
<span><span class="co"># from 0--10 cm</span></span>
<span><span class="co"># computing the mean value ignoring missing data</span></span>
<span><span class="fu"><a href="../reference/slab-methods.html">slab</a></span><span class="op">(</span></span>
<span>  <span class="va">sp4</span>,</span>
<span>  fm <span class="op">=</span> <span class="op">~</span> <span class="va">sand</span> <span class="op">+</span> <span class="va">silt</span> <span class="op">+</span> <span class="va">clay</span>,</span>
<span>  slab.structure <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  slab.fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   variable all.profiles value top bottom contributing_fraction</span></span>
<span><span class="co">#&gt; 1     sand            1 47.63   0     10                     1</span></span>
<span><span class="co">#&gt; 2     silt            1 31.15   0     10                     1</span></span>
<span><span class="co">#&gt; 3     clay            1 21.11   0     10                     1</span></span>
<span></span>
<span><span class="co"># again, this time within groups defined by a site-level attribute:</span></span>
<span><span class="fu"><a href="../reference/slab-methods.html">slab</a></span><span class="op">(</span></span>
<span>  <span class="va">sp4</span>,</span>
<span>  fm <span class="op">=</span> <span class="va">group</span> <span class="op">~</span> <span class="va">sand</span> <span class="op">+</span> <span class="va">silt</span> <span class="op">+</span> <span class="va">clay</span>,</span>
<span>  slab.structure <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>,  <span class="fl">10</span><span class="op">)</span>,</span>
<span>  slab.fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   variable group value top bottom contributing_fraction</span></span>
<span><span class="co">#&gt; 1     sand     A 48.26   0     10                     1</span></span>
<span><span class="co">#&gt; 2     silt     A 31.52   0     10                     1</span></span>
<span><span class="co">#&gt; 3     clay     A 20.30   0     10                     1</span></span>
<span><span class="co">#&gt; 4     sand     B 47.00   0     10                     1</span></span>
<span><span class="co">#&gt; 5     silt     B 30.78   0     10                     1</span></span>
<span><span class="co">#&gt; 6     clay     B 21.92   0     10                     1</span></span>
<span></span>
<span><span class="co"># again, this time over several depth ranges</span></span>
<span><span class="fu"><a href="../reference/slab-methods.html">slab</a></span><span class="op">(</span></span>
<span>  <span class="va">sp4</span>,</span>
<span>  fm <span class="op">=</span> <span class="op">~</span> <span class="va">sand</span> <span class="op">+</span> <span class="va">silt</span> <span class="op">+</span> <span class="va">clay</span>,</span>
<span>  slab.structure <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  slab.fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   variable all.profiles    value top bottom contributing_fraction</span></span>
<span><span class="co">#&gt; 1     sand            1 47.63000   0     10             1.0000000</span></span>
<span><span class="co">#&gt; 2     sand            1 42.38931  10     25             0.8733333</span></span>
<span><span class="co">#&gt; 3     sand            1 32.14607  25     40             0.5933333</span></span>
<span><span class="co">#&gt; 4     silt            1 31.15000   0     10             1.0000000</span></span>
<span><span class="co">#&gt; 5     silt            1 29.41221  10     25             0.8733333</span></span>
<span><span class="co">#&gt; 6     silt            1 31.34831  25     40             0.5933333</span></span>
<span><span class="co">#&gt; 7     clay            1 21.11000   0     10             1.0000000</span></span>
<span><span class="co">#&gt; 8     clay            1 28.10687  10     25             0.8733333</span></span>
<span><span class="co">#&gt; 9     clay            1 36.26966  25     40             0.5933333</span></span>
<span></span>
<span><span class="co"># again, this time along 1-cm slices, computing quantiles</span></span>
<span><span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slab-methods.html">slab</a></span><span class="op">(</span><span class="va">sp4</span>, fm <span class="op">=</span> <span class="op">~</span> <span class="va">Mg</span> <span class="op">+</span> <span class="va">Ca</span> <span class="op">+</span> <span class="va">ex_Ca_to_Mg</span> <span class="op">+</span> <span class="va">CEC_7</span> <span class="op">+</span> <span class="va">clay</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># see ?slab for details on the default aggregate function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">agg</span><span class="op">)</span></span>
<span><span class="co">#&gt;   variable all.profiles  p.q5  p.q25 p.q50  p.q75 p.q95 top bottom contributing_fraction</span></span>
<span><span class="co">#&gt; 1       Mg            1 6.015 12.175 14.60 21.125 27.13   0      1                     1</span></span>
<span><span class="co">#&gt; 2       Mg            1 6.015 12.175 14.60 21.125 27.13   1      2                     1</span></span>
<span><span class="co">#&gt; 3       Mg            1 6.015 12.175 19.15 25.650 27.76   2      3                     1</span></span>
<span><span class="co">#&gt; 4       Mg            1 6.195 13.175 21.05 25.050 30.73   3      4                     1</span></span>
<span><span class="co">#&gt; 5       Mg            1 6.195 13.175 21.05 25.050 30.73   4      5                     1</span></span>
<span><span class="co">#&gt; 6       Mg            1 6.195 13.175 21.05 26.250 31.72   5      6                     1</span></span>
<span></span>
<span><span class="co"># plot median +/i bounds defined by the 25th and 75th percentiles</span></span>
<span><span class="co"># this is lattice graphics, syntax is a little rough</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">top</span> <span class="op">~</span> <span class="va">p.q50</span> <span class="op">|</span> <span class="va">variable</span>, data <span class="op">=</span> <span class="va">agg</span>, ylab <span class="op">=</span> <span class="st">'Depth'</span>, </span>
<span>       xlab <span class="op">=</span> <span class="st">'median bounded by 25th and 75th percentiles'</span>,</span>
<span>       lower <span class="op">=</span> <span class="va">agg</span><span class="op">$</span><span class="va">p.q25</span>, upper <span class="op">=</span> <span class="va">agg</span><span class="op">$</span><span class="va">p.q75</span>, ylim <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>       panel <span class="op">=</span> <span class="va">panel.depth_function</span>,</span>
<span>       alpha <span class="op">=</span> <span class="fl">0.25</span>, sync.colors <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>superpose.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">'RoyalBlue'</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       prepanel <span class="op">=</span> <span class="va">prepanel.depth_function</span>,</span>
<span>       cf <span class="op">=</span> <span class="va">agg</span><span class="op">$</span><span class="va">contributing_fraction</span>, cf.col <span class="op">=</span> <span class="st">'black'</span>, cf.interval <span class="op">=</span> <span class="fl">5</span>,</span>
<span>       layout <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>, strip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/strip.default.html" class="external-link">strip.custom</a></span><span class="op">(</span>bg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>         tick.number <span class="op">=</span> <span class="fl">4</span>,</span>
<span>         alternating <span class="op">=</span> <span class="fl">3</span>,</span>
<span>         relation <span class="op">=</span> <span class="st">'free'</span></span>
<span>       <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/slab-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Depth-wise aggregation can be useful for visual evaluation of multivariate similarity among groups of profiles.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># processing the "napa" and tehama profiles</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="../reference/profile_id.html">profile_id</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'napa'</span>, <span class="st">'tehama'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">napa.and.tehama</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slab-methods.html">slab</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">[</span><span class="va">idx</span>,<span class="op">]</span>, fm <span class="op">=</span> <span class="op">~</span> <span class="va">Mg</span> <span class="op">+</span> <span class="va">Ca</span> <span class="op">+</span> <span class="va">ex_Ca_to_Mg</span> <span class="op">+</span> <span class="va">CEC_7</span> <span class="op">+</span> <span class="va">clay</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine with the collection-wide aggregate data</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/make.groups.html" class="external-link">make.groups</a></span><span class="op">(</span>collection <span class="op">=</span> <span class="va">agg</span>, napa.and.tehama <span class="op">=</span> <span class="va">napa.and.tehama</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compare graphically:</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">top</span> <span class="op">~</span> <span class="va">p.q50</span> <span class="op">|</span> <span class="va">variable</span>, groups <span class="op">=</span> <span class="va">which</span>, data <span class="op">=</span> <span class="va">g</span>, ylab <span class="op">=</span> <span class="st">'Depth'</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">'median bounded by 25th and 75th percentiles'</span>,</span>
<span>       lower <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">p.q25</span>, upper <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">p.q75</span>, ylim <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>       panel <span class="op">=</span> <span class="va">panel.depth_function</span>,</span>
<span>       alpha <span class="op">=</span> <span class="fl">0.25</span>, sync.colors <span class="op">=</span> <span class="cn">TRUE</span>, cf <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">contributing_fraction</span>, cf.interval <span class="op">=</span> <span class="fl">10</span>,</span>
<span>       par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>superpose.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>         col <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'RoyalBlue'</span>, <span class="st">'Red4'</span><span class="op">)</span>,</span>
<span>         lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         lty <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>       <span class="op">)</span><span class="op">)</span>,</span>
<span>       prepanel <span class="op">=</span> <span class="va">prepanel.depth_function</span>,</span>
<span>       layout <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>       strip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/strip.default.html" class="external-link">strip.custom</a></span><span class="op">(</span>bg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>         tick.number <span class="op">=</span> <span class="fl">4</span>,</span>
<span>         alternating <span class="op">=</span> <span class="fl">3</span>,</span>
<span>         relation <span class="op">=</span> <span class="st">'free'</span></span>
<span>       <span class="op">)</span><span class="op">)</span>,</span>
<span>       auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       lines <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       points <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/slab-2-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="change-of-support">Change of Support<a class="anchor" aria-label="anchor" href="#change-of-support"></a>
</h3>
<p>There is often a need for converting data to a new set of depth intervals. This re-alignment of horizon depths via aggregation can be considered a type of <em>change of support</em>. The operation on SoilProfileCollections requires some aggregation function (mean, median, etc.) and possibly interpolation (e.g. splines).</p>
<p>The <code><a href="../reference/slab-methods.html">slab()</a></code> function is the simplest way to implement a change of depth support via aggregation. The following example is based on a set of 9 randomly generated profiles, re-aligned to the Global Soil Map (GSM) standard depths.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 9 random profiles</span></span>
<span><span class="co"># 1 simulated properties via logistic power peak (LPP) function</span></span>
<span><span class="co"># 6, 7, or 8 horizons per profile</span></span>
<span><span class="co"># result is a list of single-profile SPC</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, </span>
<span>  <span class="va">random_profile</span>, </span>
<span>  n <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>  n_prop <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  method <span class="op">=</span> <span class="st">'LPP'</span>,</span>
<span>  SPC <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine into single SPC</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">combine</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># GSM depths</span></span>
<span><span class="va">gsm.depths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># aggregate using mean: wt.mean within slabs</span></span>
<span><span class="co"># see ?slab for ideas on how to parameterize slab.fun</span></span>
<span><span class="va">d.gsm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slab-methods.html">slab</a></span><span class="op">(</span><span class="va">d</span>, fm <span class="op">=</span> <span class="va">id</span> <span class="op">~</span> <span class="va">p1</span>, slab.structure <span class="op">=</span> <span class="va">gsm.depths</span>, slab.fun <span class="op">=</span> <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note: result is in long-format</span></span>
<span><span class="co"># note: horizon names are lost due to aggregation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d.gsm</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt;   variable id    value top bottom contributing_fraction</span></span>
<span><span class="co">#&gt; 1       p1  1 19.21595   0      5             1.0000000</span></span>
<span><span class="co">#&gt; 2       p1  1 19.22002   5     15             1.0000000</span></span>
<span><span class="co">#&gt; 3       p1  1 19.22273  15     30             1.0000000</span></span>
<span><span class="co">#&gt; 4       p1  1 19.54932  30     60             1.0000000</span></span>
<span><span class="co">#&gt; 5       p1  1 22.43912  60    100             1.0000000</span></span>
<span><span class="co">#&gt; 6       p1  1 21.17776 100    200             0.8513514</span></span>
<span><span class="co">#&gt; 7       p1  2 13.70462   0      5             1.0000000</span></span></code></pre></div>
<p>A simple graphical comparison of the original and re-aligned soil profile data, after converting <code><a href="../reference/slab-methods.html">slab()</a></code> result from long -&gt; wide format with {data.table} <code><a href="https://Rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast()</a></code>:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reshape to wide format</span></span>
<span><span class="co"># this scales to &gt; 1 aggregated variables</span></span>
<span><span class="va">d.gsm.pedons</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">d.gsm</span><span class="op">)</span>, <span class="va">id</span> <span class="op">+</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span> <span class="op">~</span> <span class="va">variable</span>, value.var <span class="op">=</span> <span class="st">'value'</span><span class="op">)</span></span>
<span><span class="fu">depths</span><span class="op">(</span><span class="va">d.gsm.pedons</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span>
<span></span>
<span><span class="co"># iterate over aggregated profiles and make new hz names</span></span>
<span><span class="va">d.gsm.pedons</span><span class="op">$</span><span class="va">hzname</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profileApply.html">profileApply</a></span><span class="op">(</span><span class="va">d.gsm.pedons</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'GSM-'</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="../reference/nrow.html">nrow</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compare original and aggregated</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, mfrow <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">d</span>, color <span class="op">=</span> <span class="st">'p1'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">d.gsm.pedons</span>, color <span class="op">=</span> <span class="st">'p1'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-48-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Note that re-aligned data may not represent reality (and should therefore be used with caution) when the original soil depth is shallower than the deepest of the new (re-aligned) horizon depths. The <code>contributing_fraction</code> metric returned by <code><a href="../reference/slab-methods.html">slab()</a></code> can be useful for assessing how much <em>real</em> data were used to generate the new set of re-aligned data.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reshape to wide format</span></span>
<span><span class="va">d.gsm.pedons.2</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">d.gsm</span><span class="op">)</span>, <span class="va">id</span> <span class="op">+</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span> <span class="op">~</span> <span class="va">variable</span>, value.var <span class="op">=</span> <span class="st">'contributing_fraction'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">depths</span><span class="op">(</span><span class="va">d.gsm.pedons.2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span>
<span></span>
<span><span class="co"># compare original and aggregated</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, mfrow <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">d.gsm.pedons</span>, name <span class="op">=</span> <span class="st">''</span>, color <span class="op">=</span> <span class="st">'p1'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span></span>
<span>  <span class="va">d.gsm.pedons.2</span>,</span>
<span>  name <span class="op">=</span> <span class="st">''</span>,</span>
<span>  color <span class="op">=</span> <span class="st">'p1'</span>,</span>
<span>  col.label <span class="op">=</span> <span class="st">'Contributing Fraction'</span>,</span>
<span>  col.palette <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">'Spectral'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-49-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="pair-wise-dissimilarity-ncsp">Pair-Wise Dissimilarity: <code>NCSP()</code><a class="anchor" aria-label="anchor" href="#pair-wise-dissimilarity-ncsp"></a>
</h2>
<p>Calculation of between-profile dissimilarity is performed using <code><a href="../reference/NCSP.html">NCSP()</a></code> (Numerical Classification of Soil Profiles). As of aqp 2.0, <code><a href="../reference/NCSP.html">NCSP()</a></code> replaces the older implementation in <code><a href="../reference/pc.html">profile_compare()</a></code> which is now deprecated. Dissimilarity values depend on attributes selection (e.g. clay, CEC, pH , etc.), optional depth-weighting parameter (<code>k</code>), and a maximum depth of evaluation (<code>maxDepth</code>).</p>
<p>See the <a href="http://ncss-tech.github.io/aqp/reference/pc.html" class="external-link">function manual page</a> and <a href="http://dx.doi.org/10.1016/j.cageo.2012.10.020" class="external-link">this paper</a> for details.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/" class="external-link">cluster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncss-tech/sharpshootR" class="external-link">sharpshootR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># start fresh</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span></span>
<span><span class="fu">depths</span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">~</span> <span class="va">top</span> <span class="op">+</span> <span class="va">bottom</span></span>
<span><span class="fu"><a href="../reference/hzdesgnname.html">hzdesgnname</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'name'</span></span>
<span></span>
<span><span class="co"># eval dissimilarity:</span></span>
<span><span class="co"># using Ex-Ca:Mg ratio and CEC at pH 7</span></span>
<span><span class="co"># no depth-weighting (k = 0)</span></span>
<span><span class="co"># to a maximum depth of 40 cm</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NCSP.html">NCSP</a></span><span class="op">(</span><span class="va">sp4</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'ex_Ca_to_Mg'</span>, <span class="st">'CEC_7'</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">0</span>, maxDepth <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check distance matrix:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">d</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;                colusa glenn kings mariposa mendocino napa san benito shasta shasta-trinity</span></span>
<span><span class="co">#&gt; glenn            13.8                                                                     </span></span>
<span><span class="co">#&gt; kings            16.0  13.1                                                               </span></span>
<span><span class="co">#&gt; mariposa          8.4  11.6  16.5                                                         </span></span>
<span><span class="co">#&gt; mendocino        12.1   8.2  17.0     15.5                                                </span></span>
<span><span class="co">#&gt; napa             31.5  24.9  30.5     30.3      22.2                                      </span></span>
<span><span class="co">#&gt; san benito       26.8  21.4  27.4     29.3      16.4 18.0                                 </span></span>
<span><span class="co">#&gt; shasta           17.2  13.6   8.7     17.6      17.6 34.8       23.3                      </span></span>
<span><span class="co">#&gt; shasta-trinity    6.4  16.9  22.3      9.6      17.0 30.9       28.3   23.3               </span></span>
<span><span class="co">#&gt; tehama           30.1  23.9  29.2     28.6      20.8  9.0       15.3   32.7           29.2</span></span>
<span></span>
<span><span class="co"># visualize dissimilarity matrix via divisive hierarchical clustering</span></span>
<span><span class="va">d.diana</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/diana.html" class="external-link">diana</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this function is from the sharpshootR package</span></span>
<span><span class="co"># requires some manual adjustments</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sharpshootR/man/plotProfileDendrogram.html" class="external-link">plotProfileDendrogram</a></span><span class="op">(</span></span>
<span>  <span class="va">sp4</span>,</span>
<span>  <span class="va">d.diana</span>,</span>
<span>  scaling.factor <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  y.offset <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  cex.names <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  color <span class="op">=</span> <span class="st">'ex_Ca_to_Mg'</span>,</span>
<span>  name.style <span class="op">=</span> <span class="st">'center-center'</span>,</span>
<span>  hz.depths <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot.depth.axis <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction-to-SoilProfileCollection-Objects_files/figure-html/unnamed-chunk-50-1.png" width="960" style="display: block; margin: auto;"></p>
<p>Some additional examples can be found in:</p>
<ul>
<li><a href="http://ncss-tech.github.io/AQP/aqp/genhz-distance-eval.html" class="external-link">Pair-Wise Distances by Generalized Horizon Labels</a></li>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/competing-series.html" class="external-link">Competing Soil Series</a></li>
<li><a href="http://ncss-tech.github.io/AQP/aqp/aqp-profile-dissimilarity.html" class="external-link">Soil Profile Distances</a></li>
</ul>
<hr>
<p>This document is based on <code>aqp</code> version 2.0.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Dylan Beaudette, Pierre Roudier, Andrew Brown.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
