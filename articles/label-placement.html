<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overlapping Annotation • aqp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overlapping Annotation">
<meta property="og:description" content="aqp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">aqp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction-to-SoilProfileCollection-Objects.html">Introduction to SoilProfileCollection Objects</a>
    </li>
    <li>
      <a href="../articles/NCSP.html">Numerical Classification of Soil Profiles</a>
    </li>
    <li>
      <a href="../articles/label-placement.html">Overlapping Annotation</a>
    </li>
    <li>
      <a href="../articles/new-in-aqp-2.html">What is new in aqp 2.0?</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ncss-tech/aqp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Overlapping Annotation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/aqp/blob/HEAD/vignettes/label-placement.Rmd" class="external-link"><code>vignettes/label-placement.Rmd</code></a></small>
      <div class="hidden name"><code>label-placement.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The creation of <a href="https://ncss-tech.github.io/AQP/aqp/sketches.html" class="external-link">soil profile
sketches</a> has been a cornerstone of the {aqp} package since the first
CRAN release in 2010. With the addition of horizon depth annotation in
2017 it became clear that some form of label placement adjustment would
be required to avoid overlapping annotation. Thin horizons and / or
large font sizes almost always lead to overlapping horizon depth labels
(see numbers just to the right of horizon boundaries in the figure
below).</p>
<p><img src="label-placement_files/figure-html/unnamed-chunk-1-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Version 2.0 of the {aqp} package provides two algorithms for avoiding
overlapping annotation, available in <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code> for the
adjustment of horizon depth annotation, and for general use via
<code><a href="../reference/fixOverlap.html">fixOverlap()</a></code>. Within the context of <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code>,
overlapping horizon depth labels are flagged according to an overlap
threshold computed from label text height on the current graphics
device.</p>
<p>Consider the following example soil profile sketches, created from a
single soil profile template characterized by multiple thin horizons.
Simulation and duplication were used to generate multiple copies of the
three variations on the original template.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncss-tech/aqp" class="external-link">aqp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># soil profile template</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quickSPC.html">quickSPC</a></span><span class="op">(</span></span>
<span>  <span class="st">"SPC:Oi|Oe|AAAAA|E1|E2|Bhs1Bhs1Bhs1|Bhs2|CCCCCC|RRRRRRRRRR"</span>, </span>
<span>  interval <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set variability in horizon thickness</span></span>
<span><span class="fu"><a href="../reference/horizons.html">horizons</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">thick.sd</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="co"># setup horizon designations</span></span>
<span><span class="fu"><a href="../reference/horizons.html">horizons</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'Oi'</span>, <span class="st">'Oe'</span>, <span class="st">'A'</span>, <span class="st">'E1'</span>, <span class="st">'E2'</span>, <span class="st">'Bhs1'</span>, <span class="st">'Bhs2'</span>, <span class="st">'C'</span>, <span class="st">'R'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate 3 realizations of original profile</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10101</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perturb.html">perturb</a></span><span class="op">(</span><span class="va">x</span>, n <span class="op">=</span> <span class="fl">3</span>, thickness.attr <span class="op">=</span> <span class="st">'thick.sd'</span>, min.thickness <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create 3 copies of each simulation</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/duplicate.html">duplicate</a></span><span class="op">(</span><span class="va">s</span>, times <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>Overlapping horizon depth labels are clear. Note that there are three
copies of each simulated variation on the original template.
<img src="label-placement_files/figure-html/unnamed-chunk-3-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Selecting the optimal label-adjustment methods and parameters will
depend on the collection of profiles, horizonation, profile height, font
sizes, and graphics device settings (figure height, resolution).</p>
<ul>
<li><p><em>electrostatic simulation:</em> This is generally the best
method, having deterministic solutions that typically move labels as
little as possible in fewer iterations. It does not do well with many
very thin horizons near the top or bottom of the profile. Very complex
profiles and larger font sizes may require setting <code>q</code> to
values larger than 1. Set <code>q</code> to values between 0.25-0.75 to
minimize adjustment distances. This method cannot (yet) provide a label
adjustment solution in the presence of missing horizon depths or
horizons where <code>top == bottom</code>.</p></li>
<li><p><em>simulated annealing:</em> This method is the most adaptive,
typically capable of providing reasonable solutions for even the most
complex profiles. The non-deterministic solutions can be undesirable
when preparing figures for publication.</p></li>
</ul>
<div class="section level3">
<h3 id="electrostatic-simulation">Electrostatic Simulation<a class="anchor" aria-label="anchor" href="#electrostatic-simulation"></a>
</h3>
<p>An electrostatic simulation applies forces of repulsion between
labels that are within a given distance threshold and forces of
attraction to a uniformly spaced sequence. Affected labels are
iteratively perturbed until either no overlap is reported, or a maximum
number of iterations has been reached. Label adjustment solutions are
deterministic and can be controlled by additional arguments to
<code><a href="../reference/electroStatics_1D.html">electroStatics_1D()</a></code>. The most common adjustment is via
charge density (<code>q</code>). See comparisons below.</p>
<p><img src="label-placement_files/figure-html/unnamed-chunk-4-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="simulated-annealing">Simulated Annealing<a class="anchor" aria-label="anchor" href="#simulated-annealing"></a>
</h3>
<p>This approach makes small adjustments to affected label positions
until overlap is removed, or until a maximum number of iterations is
reached. Rank order and boundary conditions are preserved. The
underlying algorithm is based on simulated annealing. Label placement
solutions are non-deterministic, use <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> if
repeatability is important. The “cooling schedule” parameters
<code>T0</code> and <code>k</code> can be used to tune the algorithm for
specific applications. These additional arguments are passed to
<code><a href="../reference/SANN_1D.html">SANN_1D()</a></code> via <code><a href="../reference/fixOverlap.html">fixOverlap()</a></code>.</p>
<p>Note that each solution, within duplicate profiles, is slightly
different.
<img src="label-placement_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="quick-comparison">Quick Comparison<a class="anchor" aria-label="anchor" href="#quick-comparison"></a>
</h2>
<p>Create a very busy profile with lots of possible overlapping horizon
depth labels.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quickSPC.html">quickSPC</a></span><span class="op">(</span></span>
<span>  <span class="st">"SPC:Oi|Oe|AAA|E1|E2|E3|BhsBhsBhsBhs|Bt1|Bt2|Bt3Bt3|CCCCCC|Ab1|Ab2|2C2C2C2C2C2C|2Cr|2R2R2R2R2R2R2R2R"</span>, </span>
<span>  interval <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">hzID</span><span class="op">)</span></span></code></pre></div>
<p>Set arguments to <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code> and define a custom function
to demonstrate various label adjustment settings.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pretty colors</span></span>
<span><span class="va">.bluecolors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">25</span>, palette <span class="op">=</span> <span class="st">'Blues'</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">25</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># plotSPC arguments</span></span>
<span><span class="va">.a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  width <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>  max.depth <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  hz.depths <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  name.style <span class="op">=</span> <span class="st">'center-center'</span>, </span>
<span>  cex.names <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  depth.axis <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  color <span class="op">=</span> <span class="st">'z'</span>,</span>
<span>  show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  print.id <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  col.palette <span class="op">=</span> <span class="va">.bluecolors</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set plotSPC default arguments</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>.aqp.plotSPC.args <span class="op">=</span> <span class="va">.a</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># wrapper function to test label collision solutions</span></span>
<span><span class="va">testIt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># make sketches</span></span>
<span>  <span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># a normalized index of label adjustment</span></span>
<span>  <span class="va">.LAI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">'last_spc_plot'</span>, envir <span class="op">=</span> <span class="va">aqp.env</span><span class="op">)</span><span class="op">$</span><span class="va">hz.depth.LAI</span></span>
<span>  <span class="va">.LAI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.LAI</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">.LAI</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># annotate with label adjustment index</span></span>
<span>  <span class="va">.txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"LAI: %0.3f"</span>, <span class="va">.LAI</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="va">.txt</span>, side <span class="op">=</span> <span class="fl">1</span>, at <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Compare and contrast. The “LAI” is an index of label adjustment,
relative to the original label positions. Larger values imply a higher
degree of adjustment. Note that each simulated annealing (SANN) label
adjustment is different, unless randomness is “controlled” using
<code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, mfcol <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">testIt</span><span class="op">(</span><span class="va">x</span>, fixLabelCollisions <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">'No\nAdjustment'</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, adj <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">testIt</span><span class="op">(</span><span class="va">x</span>, fixOverlapArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'S'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">'SANN\nsim 1'</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, adj <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">testIt</span><span class="op">(</span><span class="va">x</span>, fixOverlapArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'S'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">'SANN\nsim 2'</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, adj <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">testIt</span><span class="op">(</span><span class="va">x</span>, fixOverlapArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'S'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">'SANN\nsim 3'</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, adj <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">testIt</span><span class="op">(</span><span class="va">x</span>, fixOverlapArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'E'</span>, q <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">'Electrostatic\nq = 1.5'</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, adj <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">testIt</span><span class="op">(</span><span class="va">x</span>, fixOverlapArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'E'</span>, q <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">'Electrostatic\nq = 1'</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, adj <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">testIt</span><span class="op">(</span><span class="va">x</span>, fixOverlapArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'E'</span>, q <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">'Electrostatic\nq = 0.5'</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, adj <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">testIt</span><span class="op">(</span><span class="va">x</span>, fixOverlapArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'E'</span>, q <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">'Electrostatic\nq = 0.25'</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>, adj <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="label-placement_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;"></p>
<!--

```r
library(aqp)
library(soilDB)

s <- c('inks' , 'pardee', 'clarksville', 'palau', 'hao', 'inks', 'eheuiki', 'puaulu', 'zook', 'cecil')
x <- fetchOSD(s)

par(mar = c(0, 0, 0, 3))

.args <- list(width = 0.3, name.style = 'center-center', hz.depths = TRUE, cex.names = 1)
options(.aqp.plotSPC.args = .args)

plotSPC(x, fixOverlapArgs = list(method = 'E', q = 1.25), max.depth = 151)
```

<img src="label-placement_files/figure-html/unnamed-chunk-9-1.png" width="768" style="display: block; margin: auto;" />

```r
plotSPC(x, fixOverlapArgs = list(method = 'E', q = 1), max.depth = 151)
```

<img src="label-placement_files/figure-html/unnamed-chunk-9-2.png" width="768" style="display: block; margin: auto;" />

```r
plotSPC(x, fixOverlapArgs = list(method = 'E', q = 0.75), max.depth = 151)
```

<img src="label-placement_files/figure-html/unnamed-chunk-9-3.png" width="768" style="display: block; margin: auto;" />

```r
plotSPC(x, fixOverlapArgs = list(method = 'E', q = 0.5), max.depth = 151)
```

<img src="label-placement_files/figure-html/unnamed-chunk-9-4.png" width="768" style="display: block; margin: auto;" />

```r
plotSPC(x, fixOverlapArgs = list(method = 'E', q = 0.25), max.depth = 151)
```

<img src="label-placement_files/figure-html/unnamed-chunk-9-5.png" width="768" style="display: block; margin: auto;" />

```r
plotSPC(x, fixOverlapArgs = list(method = 'S'), max.depth = 151)
```

<img src="label-placement_files/figure-html/unnamed-chunk-9-6.png" width="768" style="display: block; margin: auto;" />
-->
</div>
<div class="section level2">
<h2 id="general-cases">General Cases<a class="anchor" aria-label="anchor" href="#general-cases"></a>
</h2>
<p>The label adjustment functionality can be used outside of the context
of <code><a href="../reference/SoilProfileCollection-plotting-methods.html">plotSPC()</a></code>. The function <code>overlapMetics()</code> can
be used to determine overlap within a vector of positions based on a
given distance threshold.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3.4</span>, <span class="fl">3.5</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/overlapMetrics.html">overlapMetrics</a></span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $idx</span></span>
<span><span class="co">#&gt; [1] 3 4 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ov</span></span>
<span><span class="co">#&gt; [1] 0.125</span></span></code></pre>
<p>The <code><a href="../reference/fixOverlap.html">fixOverlap()</a></code> function will attempt adjustment, given
distance threshold and a method selection. Additional parameters are
passed on to <code><a href="../reference/SANN_1D.html">SANN_1D()</a></code> or <code><a href="../reference/electroStatics_1D.html">electroStatics_1D()</a></code>.
The <code>converged</code> attribute is included in the result to
signify that a successful solution was possible. See the manual page for
<code><a href="../reference/fixOverlap.html">fixOverlap()</a></code> for additional details.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># vector of positions, typically labels but could be profile sketch alignment on the x-axis</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2.3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5.5</span>, <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulated annealing, solution is non-deterministic</span></span>
<span><span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">s</span>, thresh <span class="op">=</span> <span class="fl">0.5</span>, method <span class="op">=</span> <span class="st">'S'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; 15 iterations</span></span></code></pre>
<pre><code><span><span class="co">#&gt; [1] 1.000000 2.282630 2.810732 4.000000 5.000000 5.500000 7.000000</span></span>
<span><span class="co">#&gt; attr(,"converged")</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># electrostatics-inspired simulation of particles</span></span>
<span><span class="co"># solution is deterministic</span></span>
<span><span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">s</span>, thresh <span class="op">=</span> <span class="fl">0.5</span>, method <span class="op">=</span> <span class="st">'E'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; 2 iterations</span></span></code></pre>
<pre><code><span><span class="co">#&gt; [1] 1.000000 1.847048 2.419053 4.000000 5.000000 5.500000 7.000000</span></span>
<span><span class="co">#&gt; attr(,"converged")</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="compare-algorithms">Compare Algorithms<a class="anchor" aria-label="anchor" href="#compare-algorithms"></a>
</h2>
<p>Define a custom function for comparing the extended output from
<code>fixOverlap(..., trace = TRUE)</code> using both electrostatic
simulation (<code>method = 'E'</code>) and simulated annealing
(<code>method = 'S')</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evalMethods</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">thresh</span>, <span class="va">q</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span>, palette <span class="op">=</span> <span class="st">'Zissou 1'</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="va">thresh</span>, method <span class="op">=</span> <span class="st">'E'</span>, maxIter <span class="op">=</span> <span class="fl">100</span>, trace <span class="op">=</span> <span class="cn">TRUE</span>, q <span class="op">=</span> <span class="va">q</span><span class="op">)</span></span>
<span>  <span class="va">.n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nrow.html">nrow</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">states</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">0.5</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">'black'</span>, fg <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, heights <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0.33</span>, <span class="fl">0.66</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">cost</span><span class="op">)</span>, <span class="va">z</span><span class="op">$</span><span class="va">cost</span>, las <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">'b'</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, xlim <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Converged (%s): %s"</span>, <span class="va">.n</span>, <span class="va">z</span><span class="op">$</span><span class="va">converged</span><span class="op">)</span>, at <span class="op">=</span> <span class="fl">0</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.75</span>, font <span class="op">=</span> <span class="fl">3</span>, adj <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span><span class="op">$</span><span class="va">states</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">1</span>, las <span class="op">=</span> <span class="fl">1</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="va">cols</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, times <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">x</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">.n</span> <span class="op">+</span> <span class="fl">1</span>, times <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">z</span><span class="op">$</span><span class="va">x</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="va">x</span>, col <span class="op">=</span> <span class="va">cols</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, font <span class="op">=</span> <span class="fl">2</span>, pos <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.n</span> <span class="op">+</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="va">z</span><span class="op">$</span><span class="va">x</span>, col <span class="op">=</span> <span class="va">cols</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, font <span class="op">=</span> <span class="fl">2</span>, pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, at <span class="op">=</span> <span class="fu"><a href="../reference/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, col.axis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">'fg'</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span>, cex.axis <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">'Electrostatic Simulation'</span>, line <span class="op">=</span> <span class="fl">1</span>, col.main <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## SANN_1D doesn't always preserve rank ordering</span></span>
<span>  <span class="co">##  -&gt;&gt; not designed to use unsorted input</span></span>
<span>  <span class="co">##  -&gt;&gt; maybe impossible with ties in x?</span></span>
<span>  </span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="va">thresh</span>, method <span class="op">=</span> <span class="st">'S'</span>, trace <span class="op">=</span> <span class="cn">TRUE</span>, maxIter <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span>  <span class="va">.n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nrow.html">nrow</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">states</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">stats</span><span class="op">)</span>, <span class="va">z</span><span class="op">$</span><span class="va">stats</span>, las <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">'b'</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, xlim <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Converged (%s): %s"</span>, <span class="va">.n</span>, <span class="va">z</span><span class="op">$</span><span class="va">converged</span><span class="op">)</span>, at <span class="op">=</span> <span class="fl">0</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.75</span>, font <span class="op">=</span> <span class="fl">3</span>, adj <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">states</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">1</span>, las <span class="op">=</span> <span class="fl">1</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, times <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">z</span><span class="op">$</span><span class="va">states</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">.n</span>, times <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">z</span><span class="op">$</span><span class="va">x</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="va">z</span><span class="op">$</span><span class="va">states</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, col <span class="op">=</span> <span class="va">cols</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, font <span class="op">=</span> <span class="fl">2</span>, pos <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.n</span>, y <span class="op">=</span> <span class="va">z</span><span class="op">$</span><span class="va">x</span>, col <span class="op">=</span> <span class="va">cols</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.66</span>, font <span class="op">=</span> <span class="fl">2</span>, pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, at <span class="op">=</span> <span class="fu"><a href="../reference/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, col.axis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">'fg'</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span>, cex.axis <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">'Simulated Annealing'</span>, line <span class="op">=</span> <span class="fl">1</span>, col.main <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># reset graphics state</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>The top panels represent the objective function, smaller values are
better. Bottom panels illustrate perturbations to elements of the
position vector <code>x</code>. Larger values of charge density
<code>q</code> are required applying the electrostatic simulation method
to increasingly complex problems (e.g. larger thresholds, more overlap).
However, setting <code>q</code> too high will result in chaos and
failure to converge.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># explore effect of charge (q)</span></span>
<span><span class="co"># too large -&gt; chaos</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">20</span>, <span class="fl">35</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">56</span>, <span class="fl">90</span>, <span class="fl">120</span>, <span class="fl">145</span>, <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># just about right, very few perturbations required</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="label-placement_files/figure-html/unnamed-chunk-13-1.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ok, but now most label positions are affected</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">1.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="label-placement_files/figure-html/unnamed-chunk-13-2.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># too high, wasting time on more iterations</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="label-placement_files/figure-html/unnamed-chunk-13-3.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># far too high, wasting more time with little gain</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="label-placement_files/figure-html/unnamed-chunk-13-4.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># chaos and failure to converge</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="label-placement_files/figure-html/unnamed-chunk-13-5.png" width="816" style="display: block; margin: auto;"></p>
<p>Additional examples to tinker with.</p>
<pre class="eval"><code><span><span class="co"># threshold too large</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">10</span>, q <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># large threshold</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">20</span>, <span class="fl">35</span>, <span class="fl">40</span>, <span class="fl">55</span>, <span class="fl">90</span>, <span class="fl">120</span>, <span class="fl">145</span>, <span class="fl">150</span><span class="op">)</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">9</span>, q <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># single iteration enough</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">20</span>, <span class="fl">35</span>, <span class="fl">40</span>, <span class="fl">55</span>, <span class="fl">90</span>, <span class="fl">120</span>, <span class="fl">145</span>, <span class="fl">150</span><span class="op">)</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">6</span>, q <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># clusters</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">6</span>, q <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">6</span>, q <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## impact of scale / offset</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">20</span>, <span class="fl">35</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">120</span>, <span class="fl">145</span>, <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># works as expected</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># works as expected, as long as threshold is scaled</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="fl">10</span>, thresh <span class="op">=</span> <span class="fl">5</span> <span class="op">/</span> <span class="fl">10</span>, q <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># works as expected, as long as threshold is scaled</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">10</span>, thresh <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">10</span>, q <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># all work as expected, threshold not modified</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">10</span>, thresh <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">100</span>, thresh <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1000</span>, thresh <span class="op">=</span> <span class="fl">5</span>, q <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># works as expected</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">315</span>, <span class="fl">325</span>, <span class="fl">341</span>, <span class="fl">353</span>, <span class="fl">366</span>, <span class="fl">374</span>, <span class="fl">422</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">9.7</span>, q <span class="op">=</span> <span class="fl">1</span>, method <span class="op">=</span> <span class="st">'E'</span><span class="op">)</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">9.7</span>, q <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1.0075</span>, <span class="fl">1.1200</span>, <span class="fl">1.3450</span>, <span class="fl">1.6450</span>, <span class="fl">1.8700</span>, <span class="fl">1.8825</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">0.05442329</span>, q <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">evalMethods</span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">0.05442329</span>, q <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="learning-more-about-the-sann-algorithm">Learning More about the SANN Algorithm<a class="anchor" aria-label="anchor" href="#learning-more-about-the-sann-algorithm"></a>
</h2>
<p>Define a custom function for visualizing the extended output from
<code>fixOverlap(..., method = 'S', trace = TRUE)</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tracePlot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span>, <span class="va">cex.axis.labels</span> <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># setup plot device</span></span>
<span>  <span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">'black'</span>, fg <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>, widths <span class="op">=</span> <span class="fl">1</span>, heights <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># order:</span></span>
<span>  <span class="co"># B: boundary condition violation</span></span>
<span>  <span class="co"># O: rank (order) violation</span></span>
<span>  <span class="co"># +: accepted perturbation</span></span>
<span>  <span class="co"># -: rejected perturbation</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.85</span><span class="op">)</span>, <span class="st">'royalblue'</span>, <span class="st">'firebrick'</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">cols.lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">'Zissou 1'</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">cols.lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="va">cols.lines</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># total overlap (objective function) progress</span></span>
<span>  <span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">stats</span><span class="op">)</span>, <span class="va">z</span><span class="op">$</span><span class="va">stats</span>, </span>
<span>    type <span class="op">=</span> <span class="st">'h'</span>, las <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Iteration'</span>, ylab <span class="op">=</span> <span class="st">'Total Overlap'</span>,</span>
<span>    axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">log</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="va">cex.axis.labels</span>, col.axis <span class="op">=</span> <span class="st">'white'</span>, las <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">'Overlap'</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="va">cex.axis.labels</span>, font <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># deviation from original configuration</span></span>
<span>  <span class="fu"><a href="../reference/SoilProfileCollection-plotting-methods.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">stats</span><span class="op">)</span>, <span class="va">z</span><span class="op">$</span><span class="va">ssd</span>, </span>
<span>    type <span class="op">=</span> <span class="st">'h'</span>, las <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Iteration'</span>, ylab <span class="op">=</span> <span class="st">'Deviation'</span>,</span>
<span>    axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">log</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="va">cex.axis.labels</span>, col.axis <span class="op">=</span> <span class="st">'white'</span>, las <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">'Deviation'</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="va">cex.axis.labels</span>, font <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">'top'</span>, legend <span class="op">=</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="st">'boundary\nviolation'</span>, <span class="st">'rank\nviolation'</span>, <span class="st">'accepted\nperturbation'</span>, <span class="st">'rejected\nperturbation'</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">cols</span>, bty <span class="op">=</span> <span class="st">'n'</span>, horiz <span class="op">=</span> <span class="cn">TRUE</span>, inset <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span>, xpd <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># adjustments at each iteration</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span></span>
<span>    <span class="va">z</span><span class="op">$</span><span class="va">states</span>, type <span class="op">=</span> <span class="st">'l'</span>, </span>
<span>    lty <span class="op">=</span> <span class="fl">1</span>, las <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    xlab <span class="op">=</span> <span class="st">'Iteration'</span>, ylab <span class="op">=</span> <span class="st">'x-position'</span>,</span>
<span>    axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    col <span class="op">=</span> <span class="va">cols.lines</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="va">cex.axis.labels</span>, col.axis <span class="op">=</span> <span class="st">'white'</span>, las <span class="op">=</span> <span class="fl">1</span>, at <span class="op">=</span> <span class="va">x</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">4</span>, cex.axis <span class="op">=</span> <span class="va">cex.axis.labels</span>, col.axis <span class="op">=</span> <span class="st">'white'</span>, las <span class="op">=</span> <span class="fl">1</span>, at <span class="op">=</span> <span class="va">z</span><span class="op">$</span><span class="va">x</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">'Position'</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2.5</span>, cex <span class="op">=</span> <span class="va">cex.axis.labels</span>, font <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">1</span>, cex.axis <span class="op">=</span> <span class="fl">1</span>, col.axis <span class="op">=</span> <span class="st">'white'</span>, line <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">'Iteration'</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.5</span>, cex <span class="op">=</span> <span class="va">cex.axis.labels</span>, font <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A relatively challenging example.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine-SoilProfileCollection-method.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2.2</span>, <span class="fl">2.8</span>, <span class="fl">3.5</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">10.1</span>, <span class="fl">12.8</span>, <span class="fl">13</span>, <span class="fl">14.8</span>, <span class="fl">15</span>, <span class="fl">15.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fix overlap, return debugging information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10101</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">0.73</span>, method <span class="op">=</span> <span class="st">'S'</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; 160 iterations</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check convergence</span></span>
<span><span class="va">z</span><span class="op">$</span><span class="va">converged</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inspect algorithm trace</span></span>
<span><span class="fu">tracePlot</span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<p><img src="label-placement_files/figure-html/unnamed-chunk-15-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># trace log</span></span>
<span><span class="co"># B: boundary condition violation</span></span>
<span><span class="co"># O: rank (order) violation</span></span>
<span><span class="co"># +: accepted perturbation</span></span>
<span><span class="co"># -: rejected perturbation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">log</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  B  O  +  - </span></span>
<span><span class="co">#&gt; 22 71 64  2</span></span></code></pre>
<p>A very challenging example.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fix overlap, return debugging information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">101010</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, min <span class="op">=</span> <span class="fl">2.5</span>, max <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># widen boundary conditions</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fixOverlap.html">fixOverlap</a></span><span class="op">(</span><span class="va">x</span>, thresh <span class="op">=</span> <span class="fl">0.2</span>, trace <span class="op">=</span> <span class="cn">TRUE</span>, min.x <span class="op">=</span> <span class="fl">0</span>, max.x <span class="op">=</span> <span class="fl">10</span>, maxIter <span class="op">=</span> <span class="fl">2000</span>, adj <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; 1203 iterations</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check convergence</span></span>
<span><span class="va">z</span><span class="op">$</span><span class="va">converged</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inspect algorithm trace</span></span>
<span><span class="fu">tracePlot</span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<p><img src="label-placement_files/figure-html/unnamed-chunk-16-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Cleanup.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reset plotSPC() options</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>.aqp.plotSPC.args <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Dylan Beaudette, Pierre Roudier, Andrew Brown.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
